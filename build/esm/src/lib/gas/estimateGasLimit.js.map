{"version":3,"sources":["../../../../../src/lib/errors/index.ts","../../../../../src/lib/gas/estimateGasLimit.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;AAAA,IAAA,cAAA,GAAA,EAAA;AAAA,UAAA,CAAA,cAAA,EAAA,eAAA,CAAA;AACA,UAAA,CAAA,cAAA,EAAA,uBAAA,CAAA;;;ACIA,IAAM,aAAA,GAAgB,MAAA;AAEtB,eAAsB,gBAAA,CACpB,KACA,SAAA,EAMiB;AACjB,EAAA,IAAI;AACF,IAAA,MAAM,QAAA,GAAW,MAAM,GAAA,CAAI,WAAA,CAAY;AAAA,MACrC,MAAM,SAAA,CAAU,IAAA;AAAA,MAChB,IAAI,SAAA,CAAU,EAAA;AAAA,MACd,MAAM,SAAA,CAAU,IAAA;AAAA,MAChB,OAAO,SAAA,CAAU;AAAA,KAClB,CAAA;AACD,IAAA,OAAO,oBAAoB,QAAQ,CAAA;AAAA,EACrC,SAAS,KAAA,EAAY;AACnB,IAAA,IAAI;AAEF,MAAA,MAAM,IAAI,OAAA,CAAQ;AAAA,QAChB,MAAM,SAAA,CAAU,IAAA;AAAA,QAChB,IAAI,SAAA,CAAU,EAAA;AAAA,QACd,MAAM,SAAA,CAAU,IAAA;AAAA,QAChB,OAAO,SAAA,CAAU;AAAA,OAClB,CAAA;AAGD,MAAA,MAAM,KAAA;AAAA,IACR,SAAS,UAAA,EAAiB;AACxB,MAAA,MAAA,IAAM,4BAAY,UAAA,EAAY;AAAA,QAC5B,YAAA,EAAc;AAAA,OACf,CAAA;AAAA,IACH;AAAA,EACF;AACF;AAEO,SAAS,oBAAoB,QAAA,EAA0B;AAC5D,EAAA,IAAI,WAAW,aAAA,EAAe;AAC5B,IAAA,QAAA,GAAW,aAAA;AAAA,EACb;AAEA,EAAA,OAAQ,WAAW,GAAA,GAAO,GAAA;AAC5B","file":"estimateGasLimit.js","sourcesContent":["export * from \"./parseError\";\nexport * from \"./transactionsErrors\";\n","import type { Address } from \"viem\";\n\nimport { extendError } from \"lib/errors\";\nimport { iRpc } from \"lib/rpc/types\";\n\nconst MIN_GAS_LIMIT = 22000n;\n\nexport async function estimateGasLimit(\n  rpc: iRpc,\n  txnParams: {\n    to: Address;\n    data: string;\n    from: string;\n    value?: bigint;\n  }\n): Promise<bigint> {\n  try {\n    const gasLimit = await rpc.estimateGas({\n      from: txnParams.from,\n      to: txnParams.to,\n      data: txnParams.data,\n      value: txnParams.value,\n    });\n    return applyGasLimitBuffer(gasLimit);\n  } catch (error: any) {\n    try {\n      // this call should throw another error instead of the `error`\n      await rpc.ethCall({\n        from: txnParams.from,\n        to: txnParams.to,\n        data: txnParams.data,\n        value: txnParams.value,\n      });\n\n      // if not we throw estimateGas error\n      throw error;\n    } catch (innerError: any) {\n      throw extendError(innerError, {\n        errorContext: \"gasLimit\",\n      });\n    }\n  }\n}\n\nexport function applyGasLimitBuffer(gasLimit: bigint): bigint {\n  if (gasLimit < MIN_GAS_LIMIT) {\n    gasLimit = MIN_GAS_LIMIT;\n  }\n\n  return (gasLimit * 11n) / 10n; // add a 10% buffer\n}\n"]}