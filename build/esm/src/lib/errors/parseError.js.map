{"version":3,"sources":["../../../../../src/lib/errors/parseError.ts"],"names":["default"],"mappings":"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","file":"parseError.js","sourcesContent":["import cryptoJs from \"crypto-js\";\nimport { Abi, decodeErrorResult } from \"viem\";\n\nimport { CustomErrors } from \"abis\";\n\nimport {\n  CustomErrorName,\n  TxErrorType,\n  extractDataFromError,\n  extractTxnError,\n  getIsUserError,\n  getIsUserRejectedError,\n} from \"./transactionsErrors\";\n\nexport type OrderErrorContext =\n  | \"simulation\"\n  | \"gasLimit\"\n  | \"gasPrice\"\n  | \"bestNonce\"\n  | \"sending\"\n  | \"pending\"\n  | \"relayer\"\n  | \"minting\"\n  | \"execution\"\n  | \"unknown\";\n\nexport type ErrorLike = {\n  message?: string;\n  stack?: string;\n  name?: string;\n  code?: number | string;\n  data?: any;\n  error?: ErrorLike;\n  errorSource?: string;\n  errorContext?: OrderErrorContext;\n  parentError?: ErrorLike;\n  tags?: string;\n  isAdditionalValidationPassed?: boolean;\n  additionalValidationType?: string;\n  info?: {\n    error?: ErrorLike;\n  };\n};\n\nexport type ErrorData = {\n  errorContext?: OrderErrorContext;\n  errorMessage?: string;\n  errorGroup?: string;\n  errorStack?: string;\n  errorStackHash?: string;\n  errorStackGroup?: string;\n  errorName?: string;\n  contractError?: string;\n  contractErrorArgs?: any;\n  isUserError?: boolean;\n  isUserRejectedError?: boolean;\n  reason?: string;\n  data?: any;\n  txErrorType?: TxErrorType;\n  txErrorData?: unknown;\n  errorSource?: string;\n  isAdditionalValidationPassed?: boolean;\n  additionalValidationType?: string;\n  parentError?: ErrorData;\n  errorDepth?: number;\n};\n\nconst URL_REGEXP =\n  /((?:http[s]?:\\/\\/.)?(?:www\\.)?[-a-zA-Z0-9@%._\\\\+~#=]{2,256}\\.[a-z]{2,6}\\b(?::\\d+)?)(?:[-a-zA-Z0-9@:%_\\\\+.~#?&\\\\/\\\\/=]*)/gi;\n\nconst MAX_ERRORS_DEPTH = 1;\n\nexport function extendError(\n  error: ErrorLike | unknown,\n  params: {\n    errorContext?: OrderErrorContext;\n    errorSource?: string;\n    isAdditionalValidationPassed?: boolean;\n    additionalValidationType?: string;\n    data?: any;\n  }\n): ErrorLike {\n  let errorLike: ErrorLike;\n\n  if (typeof error === \"object\" && error !== null) {\n    errorLike = error;\n  } else if (typeof error === \"string\") {\n    errorLike = {\n      message: error,\n    };\n  } else {\n    errorLike = {};\n  }\n\n  errorLike.errorContext = params.errorContext;\n  errorLike.errorSource = params.errorSource;\n  errorLike.isAdditionalValidationPassed = params.isAdditionalValidationPassed;\n  errorLike.additionalValidationType = params.additionalValidationType;\n  errorLike.data = params.data;\n\n  return errorLike;\n}\n\nexport function parseError(\n  error: ErrorLike | string | undefined,\n  errorDepth = 0\n): ErrorData | undefined {\n  if (errorDepth > MAX_ERRORS_DEPTH) {\n    return undefined;\n  }\n\n  // all human readable details are in info field\n  const errorInfo = typeof error === \"string\" ? undefined : error?.info?.error;\n  const errorSource =\n    typeof error === \"string\" ? undefined : error?.errorSource;\n  const errorContext: OrderErrorContext | undefined =\n    typeof error === \"string\" ? undefined : error?.errorContext;\n  const isAdditionalValidationPassed =\n    typeof error === \"string\" ? undefined : error?.isAdditionalValidationPassed;\n  const additionalValidationType =\n    typeof error === \"string\" ? undefined : error?.additionalValidationType;\n  const data = typeof error === \"string\" ? undefined : error?.data;\n\n  let errorMessage = \"Unknown error\";\n  let errorStack: string | undefined = undefined;\n  let errorStackHash: string | undefined = undefined;\n  let errorName: string | undefined = undefined;\n  let contractError: string | undefined = undefined;\n  let contractErrorArgs: any = undefined;\n  let txErrorType: TxErrorType | undefined = undefined;\n  let errorGroup: string | undefined = \"Unknown group\";\n  let errorStackGroup = \"Unknown stack group\";\n  let txErrorData: any = undefined;\n  let isUserError: boolean | undefined = undefined;\n  let isUserRejectedError: boolean | undefined = undefined;\n  let parentError: ErrorData | undefined = undefined;\n\n  try {\n    errorMessage = hasMessage(errorInfo)\n      ? errorInfo.message ?? (hasMessage(error) ? error.message : String(error))\n      : String(error);\n\n    errorStack = hasStack(error) ? error.stack : undefined;\n\n    if (hasName(errorInfo)) {\n      errorName = errorInfo.name;\n    } else if (hasName(error)) {\n      errorName = error.name;\n    }\n\n    try {\n      let txError: ReturnType<typeof extractTxnError> | undefined;\n\n      if (errorInfo) {\n        txError = extractTxnError(errorInfo);\n      } else if (error && typeof error === \"object\") {\n        txError = extractTxnError(error);\n      }\n\n      if (txError && txError.length) {\n        const [message, type, errorData] = txError;\n        errorMessage = message;\n        txErrorType = type || undefined;\n        txErrorData = errorData;\n        isUserError = type ? getIsUserError(type) : false;\n        isUserRejectedError = type ? getIsUserRejectedError(type) : false;\n      }\n    } catch (e) {\n      //\n    }\n\n    if (errorMessage) {\n      const errorData =\n        extractDataFromError(errorMessage) ??\n        extractDataFromError((error as any)?.message);\n      if (errorData) {\n        const parsedError = decodeErrorResult({\n          abi: CustomErrors as Abi,\n          data: errorData as `0x${string}`,\n        });\n\n        if (parsedError) {\n          contractError = parsedError.errorName;\n          contractErrorArgs = parsedError.args;\n        }\n      }\n    }\n\n    if (typeof error !== \"string\" && error?.parentError) {\n      parentError = parseError(error.parentError, errorDepth + 1);\n    }\n  } catch (e) {\n    //\n  }\n\n  if (errorStack) {\n    errorStackHash = cryptoJs.SHA256(errorStack).toString(cryptoJs.enc.Hex);\n    errorStackGroup = errorStack.slice(0, 300);\n    errorStackGroup = errorStackGroup.replace(URL_REGEXP, \"$1\");\n    errorStackGroup = errorStackGroup.replace(/\\d+/g, \"XXX\");\n  }\n\n  if (txErrorType) {\n    errorGroup = `Txn Error: ${txErrorType}`;\n  } else if (errorMessage) {\n    errorGroup = errorMessage.slice(0, 300);\n    errorGroup = errorGroup.replace(URL_REGEXP, \"$1\");\n    errorGroup = errorGroup.replace(/\\d+/g, \"XXX\");\n    errorGroup = errorGroup.slice(0, 50);\n  } else if (errorName) {\n    errorGroup = errorName;\n  }\n\n  return {\n    errorMessage,\n    errorGroup,\n    errorStackGroup,\n    errorStack,\n    errorStackHash,\n    errorName,\n    contractError,\n    contractErrorArgs,\n    errorContext,\n    isUserError,\n    data,\n    isUserRejectedError,\n    txErrorType,\n    txErrorData,\n    errorSource,\n    parentError,\n    isAdditionalValidationPassed,\n    additionalValidationType,\n    errorDepth,\n  };\n}\n\nexport function isContractError(error: ErrorData, errorType: CustomErrorName) {\n  return error.contractError === errorType;\n}\n\nfunction hasMessage(error: unknown): error is { message: string } {\n  return (\n    !!error &&\n    typeof error === \"object\" &&\n    typeof (error as { message: string }).message === \"string\"\n  );\n}\n\nfunction hasStack(error: unknown): error is { stack: string } {\n  return (\n    !!error &&\n    typeof error === \"object\" &&\n    typeof (error as { stack: string }).stack === \"string\"\n  );\n}\n\nfunction hasName(error: unknown): error is { name: string } {\n  return (\n    !!error &&\n    typeof error === \"object\" &&\n    typeof (error as { name: string }).name === \"string\"\n  );\n}\n\nexport class CustomError extends Error {\n  isGmxCustomError = true;\n  args: any;\n\n  constructor({\n    name,\n    message,\n    args,\n  }: {\n    name: string;\n    message: string;\n    args: any;\n  }) {\n    super(message);\n    this.name = name;\n    this.args = args;\n  }\n}\n\nexport function isCustomError(error: Error | undefined): error is CustomError {\n  return (error as CustomError)?.isGmxCustomError === true;\n}\n\nexport function getCustomError(error: Error): CustomError | Error {\n  const data = (error as any)?.info?.error?.data ?? (error as any)?.data;\n\n  let prettyErrorName = error.name;\n  let prettyErrorMessage = error.message;\n  let prettyErrorArgs: any = undefined;\n\n  try {\n    const parsedError = decodeErrorResult({\n      abi: CustomErrors,\n      data: data,\n    });\n\n    prettyErrorArgs = parsedError.args;\n\n    prettyErrorName = parsedError.errorName;\n    prettyErrorMessage = JSON.stringify(parsedError, null, 2);\n  } catch (decodeError) {\n    return error;\n  }\n\n  const prettyError = new CustomError({\n    name: prettyErrorName,\n    message: prettyErrorMessage,\n    args: prettyErrorArgs,\n  });\n\n  return prettyError;\n}\n"]}