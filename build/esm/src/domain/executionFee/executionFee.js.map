{"version":3,"sources":["../../../../../src/domain/executionFee/executionFee.ts"],"names":[],"mappings":"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","file":"executionFee.js","sourcesContent":["import {\n  ContractsChainId,\n  getExcessiveExecutionFee,\n  getHighExecutionFee,\n  getMinExecutionFeeUsd,\n  isContractsChain,\n} from \"configs/chains\";\nimport { NATIVE_TOKEN_ADDRESS } from \"configs/tokens\";\nimport { DecreasePositionSwapType } from \"domain/decrease/types\";\nimport {\n  ExecutionFee,\n  GasLimitsConfig,\n  L1ExpressOrderGasReference,\n} from \"domain/executionFee/types\";\nimport { TokenData, TokensData } from \"domain/tokens/types\";\nimport {\n  convertBetweenTokens,\n  convertToTokenAmount,\n  convertToUsd,\n  getTokenData,\n} from \"domain/tokens/utils\";\nimport { bigMath } from \"lib/bigmath\";\nimport { USD_DECIMALS } from \"lib/numbers\";\nimport { applyFactor, expandDecimals } from \"lib/numbers\";\n\nexport function getExecutionFee(\n  chainId: number,\n  gasLimits: GasLimitsConfig,\n  // TODO optimize we only need the native token data\n  tokensData: TokensData,\n  estimatedGasLimit: bigint,\n  gasPrice: bigint,\n  oraclePriceCount: bigint,\n  numberOfParts?: number\n): ExecutionFee | undefined {\n  const nativeToken = getTokenData(tokensData, NATIVE_TOKEN_ADDRESS);\n\n  if (!nativeToken) return undefined;\n\n  // #region adjustGasLimitForEstimate. Copy from contract.\n  let baseGasLimit = gasLimits.estimatedGasFeeBaseAmount;\n  baseGasLimit += gasLimits.estimatedGasFeePerOraclePrice * oraclePriceCount;\n  const multiplierFactor = gasLimits.estimatedFeeMultiplierFactor;\n  const gasLimit =\n    baseGasLimit + applyFactor(estimatedGasLimit, multiplierFactor);\n  // #endregion\n\n  // avoid botanix gas spikes when chain is not actively used\n  const minGasCostUsd = isContractsChain(chainId)\n    ? getMinExecutionFeeUsd(chainId)\n    : undefined;\n  const minGasCost = minGasCostUsd\n    ? convertToTokenAmount(\n        minGasCostUsd,\n        nativeToken.decimals,\n        nativeToken.prices.minPrice\n      )\n    : undefined;\n\n  let feeTokenAmountPerExecution = gasLimit * gasPrice;\n\n  if (minGasCost !== undefined) {\n    feeTokenAmountPerExecution = bigMath.max(\n      feeTokenAmountPerExecution,\n      minGasCost\n    );\n  }\n\n  const feeTokenAmount =\n    feeTokenAmountPerExecution * BigInt(numberOfParts ?? 1);\n\n  const feeUsd = convertToUsd(\n    feeTokenAmount,\n    nativeToken.decimals,\n    nativeToken.prices.minPrice\n  )!;\n\n  const isFeeHigh =\n    feeUsd > expandDecimals(getHighExecutionFee(chainId), USD_DECIMALS);\n  const isFeeVeryHigh =\n    feeUsd > expandDecimals(getExcessiveExecutionFee(chainId), USD_DECIMALS);\n\n  return {\n    feeUsd,\n    feeTokenAmount,\n    feeToken: nativeToken,\n    gasLimit,\n    isFeeHigh,\n    isFeeVeryHigh,\n  };\n}\n\nexport function estimateRelayerGasLimit({\n  gasLimits,\n  tokenPermitsCount,\n  feeSwapsCount,\n  feeExternalCallsGasLimit,\n  oraclePriceCount,\n  transactionPayloadGasLimit,\n  l1GasLimit,\n}: {\n  gasLimits: GasLimitsConfig;\n  tokenPermitsCount: number;\n  feeSwapsCount: number;\n  feeExternalCallsGasLimit: bigint;\n  oraclePriceCount: number;\n  transactionPayloadGasLimit: bigint;\n  l1GasLimit: bigint;\n}) {\n  const feeSwapsGasLimit = gasLimits.singleSwap * BigInt(feeSwapsCount);\n  const oraclePricesGasLimit =\n    gasLimits.estimatedGasFeePerOraclePrice * BigInt(oraclePriceCount);\n  const tokenPermitsGasLimit =\n    gasLimits.tokenPermitGasLimit * BigInt(tokenPermitsCount);\n\n  const relayParamsGasLimit =\n    feeSwapsGasLimit +\n    oraclePricesGasLimit +\n    tokenPermitsGasLimit +\n    feeExternalCallsGasLimit;\n\n  return relayParamsGasLimit + transactionPayloadGasLimit + l1GasLimit;\n}\n\nexport function approximateL1GasBuffer({\n  l1Reference,\n  sizeOfData,\n}: {\n  l1Reference: L1ExpressOrderGasReference;\n  sizeOfData: bigint;\n}) {\n  const evaluated = Math.round(\n    (Number(l1Reference.gasLimit) * Math.log(Number(sizeOfData))) /\n      Math.log(Number(l1Reference.sizeOfData))\n  );\n\n  const l1GasLimit =\n    Math.abs(evaluated) < Infinity ? BigInt(evaluated) : l1Reference.gasLimit;\n\n  return l1GasLimit;\n}\n\nexport function estimateBatchGasLimit({\n  gasLimits,\n  createOrdersCount,\n  updateOrdersCount,\n  cancelOrdersCount,\n  externalCallsGasLimit,\n  isGmxAccount,\n}: {\n  gasLimits: GasLimitsConfig;\n  createOrdersCount: number;\n  updateOrdersCount: number;\n  cancelOrdersCount: number;\n  externalCallsGasLimit: bigint;\n  isGmxAccount: boolean;\n}) {\n  const createOrdersGasLimit =\n    gasLimits.createOrderGasLimit * BigInt(createOrdersCount);\n  const updateOrdersGasLimit =\n    gasLimits.updateOrderGasLimit * BigInt(updateOrdersCount);\n  const cancelOrdersGasLimit =\n    gasLimits.cancelOrderGasLimit * BigInt(cancelOrdersCount);\n  const gmxAccountOverhead = isGmxAccount\n    ? gasLimits.gmxAccountCollateralGasLimit\n    : 0n;\n\n  return (\n    createOrdersGasLimit +\n    updateOrdersGasLimit +\n    cancelOrdersGasLimit +\n    externalCallsGasLimit +\n    gmxAccountOverhead\n  );\n}\n\nexport function estimateBatchMinGasPaymentTokenAmount({\n  chainId,\n  gasPaymentToken,\n  isGmxAccount,\n  relayFeeToken,\n  gasPrice,\n  gasLimits,\n  l1Reference,\n  tokensData,\n  createOrdersCount = 1,\n  updateOrdersCount = 0,\n  cancelOrdersCount = 0,\n  executionFeeAmount,\n}: {\n  chainId: ContractsChainId;\n  isGmxAccount: boolean;\n  gasLimits: GasLimitsConfig;\n  gasPaymentToken: TokenData;\n  relayFeeToken: TokenData;\n  tokensData: TokensData;\n  gasPrice: bigint;\n  l1Reference: L1ExpressOrderGasReference | undefined;\n  createOrdersCount: number;\n  updateOrdersCount: number;\n  cancelOrdersCount: number;\n  executionFeeAmount: bigint | undefined;\n}) {\n  const batchGasLimit = estimateBatchGasLimit({\n    gasLimits,\n    createOrdersCount,\n    updateOrdersCount,\n    cancelOrdersCount,\n    externalCallsGasLimit: 0n,\n    isGmxAccount,\n  });\n\n  const relayerGasLimit = estimateRelayerGasLimit({\n    gasLimits,\n    tokenPermitsCount: 0,\n    feeSwapsCount: relayFeeToken.address === gasPaymentToken.address ? 0 : 1,\n    feeExternalCallsGasLimit: 0n,\n    oraclePriceCount: 2,\n    transactionPayloadGasLimit: batchGasLimit,\n    l1GasLimit: l1Reference?.gasLimit ?? 0n,\n  });\n\n  const gasLimit = relayerGasLimit + batchGasLimit;\n\n  const feeAmount = gasLimit * gasPrice;\n\n  const executionGasLimit = estimateExecuteIncreaseOrderGasLimit(gasLimits, {\n    swapsCount: 2,\n    callbackGasLimit: 0n,\n  });\n\n  const executionFee =\n    executionFeeAmount ??\n    getExecutionFee(\n      chainId,\n      gasLimits,\n      tokensData,\n      executionGasLimit,\n      gasPrice,\n      4n\n    )?.feeTokenAmount;\n\n  let totalFee = feeAmount + (executionFee ?? 0n);\n\n  const minGasPaymentTokenBalance = convertBetweenTokens(\n    totalFee,\n    relayFeeToken,\n    gasPaymentToken,\n    false\n  )!;\n\n  return minGasPaymentTokenBalance;\n}\n\n/**\n * Copy from contract: `estimateExecuteIncreaseOrderGasLimit`\n */\nexport function estimateExecuteIncreaseOrderGasLimit(\n  gasLimits: GasLimitsConfig,\n  order: { swapsCount?: number; callbackGasLimit?: bigint }\n) {\n  const gasPerSwap = gasLimits.singleSwap;\n  const swapsCount = BigInt(order.swapsCount ?? 0);\n\n  return (\n    gasLimits.increaseOrder +\n    gasPerSwap * swapsCount +\n    (order.callbackGasLimit ?? 0n)\n  );\n}\n\n/**\n * Copy from contract: `estimateExecuteDecreaseOrderGasLimit`\n */\nexport function estimateExecuteDecreaseOrderGasLimit(\n  gasLimits: GasLimitsConfig,\n  order: {\n    swapsCount: number;\n    callbackGasLimit?: bigint;\n    decreaseSwapType?: DecreasePositionSwapType;\n  }\n) {\n  const gasPerSwap = gasLimits.singleSwap;\n  let swapsCount = BigInt(order.swapsCount);\n\n  if (order.decreaseSwapType !== DecreasePositionSwapType.NoSwap) {\n    swapsCount += 1n;\n  }\n\n  return (\n    gasLimits.decreaseOrder +\n    gasPerSwap * swapsCount +\n    (order.callbackGasLimit ?? 0n)\n  );\n}\n\nexport function estimateExecuteSwapOrderGasLimit(\n  gasLimits: GasLimitsConfig,\n  order: { swapsCount: number; callbackGasLimit?: bigint }\n) {\n  const gasPerSwap = gasLimits.singleSwap;\n  const swapsCount = BigInt(order.swapsCount);\n\n  return (\n    gasLimits.swapOrder +\n    gasPerSwap * swapsCount +\n    (order.callbackGasLimit ?? 0n)\n  );\n}\n\n/**\n * Only GM deposits. Do not confuse with increase with zero delta size.\n *\n * Copy from contract: `estimateExecuteDepositGasLimit`\n */\nexport function estimateExecuteDepositGasLimit(\n  gasLimits: GasLimitsConfig,\n  deposit: {\n    // We do not use this yet\n    longTokenSwapsCount?: number;\n    // We do not use this yet\n    shortTokenSwapsCount?: number;\n    callbackGasLimit?: bigint;\n  }\n) {\n  const gasPerSwap = gasLimits.singleSwap;\n  const swapsCount = BigInt(\n    (deposit.longTokenSwapsCount ?? 0) + (deposit.shortTokenSwapsCount ?? 0)\n  );\n  const gasForSwaps = swapsCount * gasPerSwap;\n\n  return (\n    gasLimits.depositToken + (deposit.callbackGasLimit ?? 0n) + gasForSwaps\n  );\n}\n\nexport function estimateExecuteGlvDepositGasLimit(\n  gasLimits: GasLimitsConfig,\n  {\n    marketsCount,\n    isMarketTokenDeposit,\n  }: {\n    isMarketTokenDeposit: boolean;\n    marketsCount: bigint;\n    initialLongTokenAmount: bigint;\n    initialShortTokenAmount: bigint;\n  }\n) {\n  const gasPerGlvPerMarket = gasLimits.glvPerMarketGasLimit;\n  const gasForGlvMarkets = gasPerGlvPerMarket * marketsCount;\n  const glvDepositGasLimit = gasLimits.glvDepositGasLimit;\n  const gasLimit = glvDepositGasLimit + gasForGlvMarkets;\n\n  if (isMarketTokenDeposit) {\n    return gasLimit;\n  }\n\n  return gasLimit + gasLimits.depositToken;\n}\n\nexport function estimateExecuteGlvWithdrawalGasLimit(\n  gasLimits: GasLimitsConfig,\n  {\n    marketsCount,\n  }: {\n    marketsCount: bigint;\n  }\n) {\n  const gasPerGlvPerMarket = gasLimits.glvPerMarketGasLimit;\n  const gasForGlvMarkets = gasPerGlvPerMarket * marketsCount;\n  const glvWithdrawalGasLimit = gasLimits.glvWithdrawalGasLimit;\n  const gasLimit = glvWithdrawalGasLimit + gasForGlvMarkets;\n\n  return gasLimit + gasLimits.withdrawalMultiToken;\n}\n\n/**\n * Only GM withdrawals. Do not confuse with decrease with zero delta size.\n *\n * Copy from contract: `estimateExecuteWithdrawalGasLimit`\n */\nexport function estimateExecuteWithdrawalGasLimit(\n  gasLimits: GasLimitsConfig,\n  withdrawal: { callbackGasLimit?: bigint }\n) {\n  // Swap is not used but supported in the contract.\n  // const gasPerSwap = gasLimits.singleSwap;\n  // const swapsCount = 0n;\n  // const gasForSwaps = swapsCount * gasPerSwap;\n\n  return gasLimits.withdrawalMultiToken + (withdrawal.callbackGasLimit ?? 0n);\n}\n\n/**\n * Copy from contract: `estimateExecuteShiftGasLimit`\n */\nexport function estimateExecuteShiftGasLimit(\n  gasLimits: GasLimitsConfig,\n  shift: { callbackGasLimit?: bigint }\n) {\n  return gasLimits.shift + (shift.callbackGasLimit ?? 0n);\n}\n"]}