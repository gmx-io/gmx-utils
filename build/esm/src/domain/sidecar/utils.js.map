{"version":3,"sources":["../../../../../src/domain/sidecar/utils.ts"],"names":[],"mappings":"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","file":"utils.js","sourcesContent":["import uniqueId from \"lodash/uniqueId\";\n\nimport { PositionOrderInfo } from \"domain/orders/types\";\nimport { bigMath } from \"lib/bigmath\";\nimport { USD_DECIMALS } from \"lib/numbers\";\nimport {\n  calculateDisplayDecimals,\n  formatAmount,\n  parseValue,\n  removeTrailingZeros,\n} from \"lib/numbers\";\n\nimport type { EntryField, InitialEntry, SidecarOrderEntryBase } from \"./types\";\n\nexport const MAX_PERCENTAGE = 100n;\nexport const PERCENTAGE_DECIMALS = 0;\n\nexport function getDefaultEntryField(\n  decimals: number | undefined,\n  { input, value, error }: Partial<EntryField> = {},\n  visualMultiplier?: number\n): EntryField {\n  let nextInput = \"\";\n  let nextValue: bigint | null = null;\n  let nextError = error ?? null;\n\n  if (input) {\n    nextInput = input;\n    nextValue = (decimals !== undefined && parseValue(input, decimals)) || null;\n    if (nextValue !== null && visualMultiplier !== undefined) {\n      nextValue = nextValue / BigInt(visualMultiplier);\n    }\n  } else if (value) {\n    nextInput = \"\";\n    if (decimals !== undefined) {\n      nextInput = String(\n        removeTrailingZeros(\n          formatAmount(\n            value,\n            decimals,\n            calculateDisplayDecimals(value, decimals, visualMultiplier),\n            undefined,\n            undefined,\n            visualMultiplier\n          )\n        )\n      );\n    }\n    nextValue = value;\n  }\n\n  return { input: nextInput, value: nextValue, error: nextError };\n}\n\nexport function getDefaultEntry<T extends SidecarOrderEntryBase>(\n  prefix: string,\n  override?: Partial<SidecarOrderEntryBase>\n): T {\n  return {\n    id: uniqueId(`${prefix}_`),\n    price: getDefaultEntryField(USD_DECIMALS),\n    sizeUsd: getDefaultEntryField(USD_DECIMALS),\n    percentage: getDefaultEntryField(PERCENTAGE_DECIMALS, {\n      value: MAX_PERCENTAGE,\n    }),\n    mode: \"keepPercentage\",\n    order: null,\n    txnType: null,\n    ...override,\n  } as T;\n}\n\nexport function prepareInitialEntries({\n  positionOrders,\n  sort = \"desc\",\n  visualMultiplier,\n}: {\n  positionOrders: PositionOrderInfo[] | undefined;\n  sort: \"desc\" | \"asc\";\n  visualMultiplier?: number;\n}): undefined | InitialEntry[] {\n  if (!positionOrders) return;\n\n  return positionOrders\n    .sort((a, b) => {\n      const [first, second] = sort === \"desc\" ? [a, b] : [b, a];\n      const diff = first.triggerPrice - second.triggerPrice;\n      if (diff > 0) return -1;\n      if (diff < 0) return 1;\n      return 0;\n    })\n    .map((order) => {\n      const entry: InitialEntry = {\n        sizeUsd: getDefaultEntryField(USD_DECIMALS, {\n          value: order.sizeDeltaUsd,\n        }),\n        price: getDefaultEntryField(\n          USD_DECIMALS,\n          { value: order.triggerPrice },\n          visualMultiplier\n        ),\n        order,\n      };\n\n      return entry;\n    });\n}\n\nexport function calculateEntryPercentage(\n  sizeUsd: bigint | null,\n  totalPositionSizeUsd: bigint | undefined\n): bigint | null {\n  if (\n    sizeUsd === undefined ||\n    sizeUsd === null ||\n    totalPositionSizeUsd === undefined ||\n    totalPositionSizeUsd <= 0\n  ) {\n    return null;\n  }\n\n  return bigMath.mulDiv(sizeUsd, MAX_PERCENTAGE, totalPositionSizeUsd);\n}\n\nexport function calculateEntrySizeUsd(\n  percentage: bigint | null,\n  totalPositionSizeUsd: bigint | undefined\n): bigint | null {\n  if (\n    percentage === undefined ||\n    percentage === null ||\n    percentage === 0n ||\n    totalPositionSizeUsd === undefined ||\n    totalPositionSizeUsd <= 0\n  ) {\n    return null;\n  }\n\n  return bigMath.mulDiv(totalPositionSizeUsd, percentage, MAX_PERCENTAGE);\n}\n\nexport function calculateEntryPrice(\n  priceValue: bigint | null,\n  visualMultiplier?: number\n): EntryField {\n  return getDefaultEntryField(\n    USD_DECIMALS,\n    { value: priceValue },\n    visualMultiplier\n  );\n}\n"]}