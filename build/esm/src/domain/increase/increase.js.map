{"version":3,"sources":["../../../../../src/domain/increase/increase.ts"],"names":["swapStrategy"],"mappings":";;;;;;;;;;;;;AA4EO,SAAS,2BACd,CAAA,EACyB;AACzB,EAAA,MAAM;AAAA,IACJ,UAAA;AAAA,IACA,UAAA;AAAA,IACA,sBAAA;AAAA,IACA,eAAA;AAAA,IACA,uBAAA;AAAA,IACA,gBAAA;AAAA,IACA,MAAA;AAAA,IACA,QAAA;AAAA,IACA,YAAA;AAAA,IACA,cAAA;AAAA,IACA,QAAA;AAAA,IACA,6BAAA;AAAA,IACA,2BAAA;AAAA,IACA,iBAAA;AAAA,IACA,YAAA;AAAA,IACA,gBAAA;AAAA,IACA,WAAA;AAAA,IACA,QAAA;AAAA,IACA,eAAA;AAAA,IACA,OAAA;AAAA,IACA,uBAAA;AAAA,IACA;AAAA,GACF,GAAI,CAAA;AAEJ,EAAA,MAAM,YAAA,GAA+B;AAAA,IACnC,IAAA,EAAM,QAAA;AAAA,IACN,iBAAA,EAAmB,MAAA;AAAA,IACnB,aAAA,EAAe,MAAA;AAAA,IACf,QAAA,EAAU,EAAA;AAAA,IACV,SAAA,EAAW,EAAA;AAAA,IACX,KAAA,EAAO,EAAA;AAAA,IACP,MAAA,EAAQ,EAAA;AAAA,IACR,OAAA,EAAS,EAAA;AAAA,IACT,QAAA,EAAU,EAAA;AAAA,IACV,OAAA,EAAS;AAAA,GACX;AAEA,EAAA,MAAM,MAAA,GAAkC;AAAA,IACtC,uBAAA,EAAyB,EAAA;AAAA,IACzB,oBAAA,EAAsB,EAAA;AAAA,IAEtB,qBAAA,EAAuB,EAAA;AAAA,IACvB,kBAAA,EAAoB,EAAA;AAAA,IAEpB,YAAA;AAAA,IAEA,gBAAA,EAAkB,EAAA;AAAA,IAElB,YAAA,EAAc,EAAA;AAAA,IACd,iBAAA,EAAmB,EAAA;AAAA,IAEnB,iBAAA,EAAmB,EAAA;AAAA,IAEnB,UAAA,EAAY,EAAA;AAAA,IACZ,sBAAA,EAAwB,EAAA;AAAA,IACxB,eAAA,EAAiB,EAAA;AAAA,IACjB,YAAA,EAAc,EAAA;AAAA,IACd,eAAA,EAAiB,EAAA;AAAA,IACjB,uBAAA,EAAyB,EAAA;AAAA,IACzB,kCAAA,EAAoC,EAAA;AAAA,IAEpC,cAAA,EAAgB,EAAA;AAAA,IAChB,QAAA,EAAU,EAAA;AAAA,IACV,YAAA,EAAc,EAAA;AAAA,IACd,cAAA,EAAgB,EAAA;AAAA,IAChB,eAAA,EAAiB,EAAA;AAAA,IACjB,aAAA,EAAe,EAAA;AAAA,IACf,2BAAA,EAA6B,EAAA;AAAA,IAC7B,2BAAA,EAA6B,EAAA;AAAA,IAE7B,cAAA;AAAA,IACA,oBAAA,EAAsB;AAAA,GACxB;AAEA,EAAA,MAAM,UAAU,cAAA,KAAmB,MAAA;AAEnC,EAAA,MAAM,qBAAA,GAAgE,OAAA,GAClE,CAAC,QAAA,EAAU,WAAW,CAAA,GACtB,MAAA;AAEJ,EAAA,MAAM,SAAS,yBAAA,CAA0B;AAAA,IACvC,YAAA;AAAA,IACA,UAAA;AAAA,IACA,sBAAA;AAAA,IACA,eAAA;AAAA,IACA,cAAA;AAAA,IACA;AAAA,GACD,CAAA;AAED,EAAA,MAAA,CAAO,aAAa,MAAA,CAAO,UAAA;AAC3B,EAAA,MAAA,CAAO,yBAAyB,MAAA,CAAO,sBAAA;AACvC,EAAA,MAAA,CAAO,kBAAkB,MAAA,CAAO,eAAA;AAChC,EAAA,MAAA,CAAO,eAAe,MAAA,CAAO,YAAA;AAC7B,EAAA,MAAA,CAAO,uBAAuB,MAAA,CAAO,oBAAA;AAErC,EAAA,MAAA,CAAO,eAAA,GAAkB,UAAU,uBAAA,IAA2B,EAAA;AAC9D,EAAA,MAAA,CAAO,aAAA,GAAgB,UAAU,qBAAA,IAAyB,EAAA;AAE1D,EAAA,IACE,MAAA,CAAO,cAAc,CAAA,IACrB,MAAA,CAAO,0BAA0B,CAAA,IACjC,MAAA,CAAO,mBAAmB,CAAA,EAC1B;AACA,IAAA,OAAO,MAAA;AAAA,EACT;AAGA,EAAA,IACE,aAAa,sBAAA,IACb,QAAA,KAAa,UACb,uBAAA,KAA4B,MAAA,IAC5B,0BAA0B,CAAA,EAC1B;AACA,IAAA,MAAA,CAAO,iBAAA,GAAoB,QAAA;AAE3B,IAAA,MAAA,CAAO,uBAAA,GAA0B,uBAAA;AACjC,IAAA,MAAA,CAAO,oBAAA,GAAuB,YAAA;AAAA,MAC5B,uBAAA;AAAA,MACA,sBAAA,CAAuB,QAAA;AAAA,MACvB,MAAA,CAAO;AAAA,KACT;AAEA,IAAA,IAAI,iBAAA,EAAmB;AACrB,MAAA,MAAMA,aAAAA,GAAqC;AAAA,QACzC,IAAA,EAAM,cAAA;AAAA,QACN,iBAAA;AAAA,QACA,aAAA,EAAe,MAAA;AAAA,QACf,GAAG;AAAA,OACL;AAEA,MAAA,MAAA,CAAO,YAAA,GAAeA,aAAAA;AAAA,IACxB,CAAA,MAAO;AACL,MAAA,MAAM,cAAc,yBAAA,CAA0B;AAAA,QAC5C,OAAA,EAAS,sBAAA;AAAA,QACT,QAAA,EAAU,eAAA;AAAA,QACV,QAAA,EAAU,uBAAA;AAAA,QACV,OAAA,EAAS,KAAA;AAAA,QACT,YAAA;AAAA,QACA,WAAA;AAAA,QACA,qBAAA;AAAA,QACA,eAAA;AAAA,QACA,OAAA;AAAA,QACA;AAAA,OACD,CAAA;AAED,MAAA,MAAA,CAAO,eAAe,WAAA,CAAY,YAAA;AAAA,IACpC;AAEA,IAAA,MAAM,aAAA,GAAgB,OAAO,YAAA,CAAa,SAAA;AAC1C,IAAA,MAAM,iBAAA,GAAoB,YAAA;AAAA,MACxB,aAAA;AAAA,MACA,eAAA,CAAgB,QAAA;AAAA,MAChB,MAAA,CAAO;AAAA,KACT;AACA,IAAA,MAAM,mBAAmB,OAAA,CAAQ,MAAA;AAAA,MAC/B,iBAAA;AAAA,MACA,QAAA;AAAA,MACA;AAAA,KACF;AACA,IAAA,MAAM,EAAE,oBAAmB,GAAI,yBAAA;AAAA,MAC7B,UAAA;AAAA,MACA,gBAAA;AAAA,MACA;AAAA,KACF;AACA,IAAA,MAAM,mBAAA,GAAsB,cAAA;AAAA,MAC1B,UAAA;AAAA,MACA,gBAAA;AAAA,MACA,kBAAA;AAAA,MACA;AAAA,KACF;AACA,IAAA,MAAM,YAAA,GAAe,WAAA,CAAY,gBAAA,EAAkB,WAAW,CAAA;AAC9D,IAAA,MAAM,kBAAA,GAAqB,+BAAA;AAAA,MACzB,MAAA,CAAO,aAAa,aAAA,EAAe;AAAA,KACrC;AACA,IAAA,MAAA,CAAO,YAAA,GAAe,WAAA,CAAY,kBAAA,EAAoB,WAAW,CAAA;AAEjE,IAAA,MAAA,CAAO,eAAe,OAAA,CAAQ,MAAA;AAAA,MAC5B,iBAAA,GACE,mBAAA,CAAoB,cAAA,GACpB,YAAA,GACA,MAAA,CAAO,YAAA;AAAA,MACT,QAAA;AAAA,MACA;AAAA,KACF;AAEA,IAAA,MAAA,CAAO,gBAAA,GAAmB,oBAAA;AAAA,MACxB,MAAA,CAAO,YAAA;AAAA,MACP,UAAA,CAAW,QAAA;AAAA,MACX,MAAA,CAAO;AAAA,KACT;AAEA,IAAA,MAAM,eAAA,GAAkB,cAAA;AAAA,MACtB,UAAA;AAAA,MACA,MAAA,CAAO,YAAA;AAAA,MACP,kBAAA;AAAA,MACA;AAAA,KACF;AACA,IAAA,MAAA,CAAO,iBAAiB,eAAA,CAAgB,cAAA;AACxC,IAAA,MAAA,CAAO,iBAAiB,eAAA,CAAgB,WAAA;AACxC,IAAA,MAAA,CAAO,QAAA,GAAW,WAAA,CAAY,MAAA,CAAO,YAAA,EAAc,WAAW,CAAA;AAE9D,IAAA,MAAA,CAAO,kBAAA,GACL,iBAAA,GACA,MAAA,CAAO,cAAA,GACP,MAAA,CAAO,kBACP,MAAA,CAAO,aAAA,GACP,MAAA,CAAO,QAAA,GACP,MAAA,CAAO,YAAA;AAET,IAAA,MAAA,CAAO,qBAAA,GAAwB,oBAAA;AAAA,MAC7B,MAAA,CAAO,kBAAA;AAAA,MACP,eAAA,CAAgB,QAAA;AAAA,MAChB,MAAA,CAAO;AAAA,KACT;AAAA,EACF,CAAA,MAAA,IACE,aAAa,gBAAA,IACb,QAAA,KAAa,UACb,gBAAA,KAAqB,MAAA,IACrB,mBAAmB,CAAA,EACnB;AACA,IAAA,MAAA,CAAO,iBAAA,GAAoB,QAAA;AAC3B,IAAA,MAAA,CAAO,gBAAA,GAAmB,gBAAA;AAC1B,IAAA,MAAA,CAAO,YAAA,GAAe,YAAA;AAAA,MACpB,gBAAA;AAAA,MACA,UAAA,CAAW,QAAA;AAAA,MACX,MAAA,CAAO;AAAA,KACT;AAEA,IAAA,MAAM,EAAE,oBAAmB,GAAI,yBAAA;AAAA,MAC7B,UAAA;AAAA,MACA,MAAA,CAAO,YAAA;AAAA,MACP;AAAA,KACF;AAEA,IAAA,MAAM,eAAA,GAAkB,cAAA;AAAA,MACtB,UAAA;AAAA,MACA,MAAA,CAAO,YAAA;AAAA,MACP,kBAAA;AAAA,MACA;AAAA,KACF;AAEA,IAAA,MAAA,CAAO,iBAAiB,eAAA,CAAgB,cAAA;AACxC,IAAA,MAAA,CAAO,iBAAiB,eAAA,CAAgB,WAAA;AACxC,IAAA,MAAA,CAAO,QAAA,GAAW,WAAA,CAAY,MAAA,CAAO,YAAA,EAAc,WAAW,CAAA;AAE9D,IAAA,MAAM,EAAE,kBAAA,EAAoB,qBAAA,EAAuB,oBAAA,KACjD,oBAAA,CAAqB;AAAA,MACnB,eAAA;AAAA,MACA,QAAA;AAAA,MACA,cAAc,MAAA,CAAO,YAAA;AAAA,MACrB,iBAAiB,MAAA,CAAO,eAAA;AAAA,MAExB,gBAAgB,MAAA,CAAO,cAAA;AAAA,MACvB,iBAAiB,MAAA,CAAO,eAAA;AAAA,MACxB,eAAe,MAAA,CAAO,aAAA;AAAA,MACtB,UAAU,MAAA,CAAO,QAAA;AAAA,MACjB,cAAc,MAAA,CAAO;AAAA,KACtB,CAAA;AAEH,IAAA,MAAA,CAAO,kBAAA,GAAqB,kBAAA;AAC5B,IAAA,MAAA,CAAO,qBAAA,GAAwB,qBAAA;AAE/B,IAAA,IAAI,iBAAA,EAAmB;AACrB,MAAA,MAAMA,aAAAA,GAAqC;AAAA,QACzC,IAAA,EAAM,cAAA;AAAA,QACN,iBAAA;AAAA,QACA,aAAA,EAAe,MAAA;AAAA,QACf,GAAG;AAAA,OACL;AAEA,MAAA,MAAA,CAAO,YAAA,GAAeA,aAAAA;AAAA,IACxB,CAAA,MAAO;AACL,MAAA,MAAM,cAAc,uBAAA,CAAwB;AAAA,QAC1C,OAAA,EAAS,sBAAA;AAAA,QACT,QAAA,EAAU,eAAA;AAAA,QACV,SAAA,EAAW,oBAAA;AAAA,QACX,OAAA,EAAS,KAAA;AAAA,QACT,YAAA;AAAA,QACA,WAAA;AAAA,QACA,eAAA;AAAA,QACA,OAAA;AAAA,QACA;AAAA,OACD,CAAA;AACD,MAAA,MAAA,CAAO,eAAe,WAAA,CAAY,YAAA;AAAA,IACpC;AAEA,IAAA,MAAM,YAAA,GAAe,OAAO,YAAA,CAAa,QAAA;AAEzC,IAAA,MAAA,CAAO,uBAAA,GAA0B,YAAA;AACjC,IAAA,MAAA,CAAO,oBAAA,GAAuB,YAAA;AAAA,MAC5B,MAAA,CAAO,uBAAA;AAAA,MACP,sBAAA,CAAuB,QAAA;AAAA,MACvB,MAAA,CAAO;AAAA,KACT;AAAA,EACF,CAAA,MAAA,IAAW,aAAa,aAAA,EAAe;AACrC,IAAA,IAAI,gBAAA,KAAqB,MAAA,IAAa,gBAAA,GAAmB,CAAA,EAAG;AAC1D,MAAA,MAAA,CAAO,gBAAA,GAAmB,gBAAA;AAC1B,MAAA,MAAA,CAAO,YAAA,GAAe,YAAA;AAAA,QACpB,gBAAA;AAAA,QACA,UAAA,CAAW,QAAA;AAAA,QACX,MAAA,CAAO;AAAA,OACT;AAEA,MAAA,MAAM,EAAE,oBAAmB,GAAI,yBAAA;AAAA,QAC7B,UAAA;AAAA,QACA,MAAA,CAAO,YAAA;AAAA,QACP;AAAA,OACF;AAEA,MAAA,MAAM,eAAA,GAAkB,cAAA;AAAA,QACtB,UAAA;AAAA,QACA,MAAA,CAAO,YAAA;AAAA,QACP,kBAAA;AAAA,QACA;AAAA,OACF;AACA,MAAA,MAAA,CAAO,iBAAiB,eAAA,CAAgB,cAAA;AACxC,MAAA,MAAA,CAAO,iBAAiB,eAAA,CAAgB,WAAA;AACxC,MAAA,MAAA,CAAO,QAAA,GAAW,WAAA,CAAY,MAAA,CAAO,YAAA,EAAc,WAAW,CAAA;AAAA,IAChE;AAEA,IAAA,IAAI,uBAAA,KAA4B,MAAA,IAAa,uBAAA,GAA0B,CAAA,EAAG;AACxE,MAAA,MAAA,CAAO,uBAAA,GAA0B,uBAAA;AACjC,MAAA,MAAA,CAAO,oBAAA,GAAuB,YAAA;AAAA,QAC5B,uBAAA;AAAA,QACA,sBAAA,CAAuB,QAAA;AAAA,QACvB,MAAA,CAAO;AAAA,OACT;AAEA,MAAA,IAAI,iBAAA,EAAmB;AACrB,QAAA,MAAMA,aAAAA,GAAqC;AAAA,UACzC,IAAA,EAAM,cAAA;AAAA,UACN,iBAAA;AAAA,UACA,aAAA,EAAe,MAAA;AAAA,UACf,GAAG;AAAA,SACL;AAEA,QAAA,MAAA,CAAO,YAAA,GAAeA,aAAAA;AAAA,MACxB,CAAA,MAAO;AACL,QAAA,MAAM,cAAc,yBAAA,CAA0B;AAAA,UAC5C,OAAA,EAAS,sBAAA;AAAA,UACT,QAAA,EAAU,eAAA;AAAA,UACV,QAAA,EAAU,uBAAA;AAAA,UACV,OAAA,EAAS,KAAA;AAAA,UACT,YAAA;AAAA,UACA,WAAA;AAAA,UACA,qBAAA;AAAA,UACA,eAAA;AAAA,UACA,OAAA;AAAA,UACA;AAAA,SACD,CAAA;AACD,QAAA,MAAA,CAAO,eAAe,WAAA,CAAY,YAAA;AAAA,MACpC;AAEA,MAAA,MAAM,YAAA,GAAe,OAAO,YAAA,CAAa,QAAA;AACzC,MAAA,MAAM,iBAAA,GAAoB,YAAA;AAAA,QACxB,YAAA;AAAA,QACA,sBAAA,CAAuB,QAAA;AAAA,QACvB,MAAA,CAAO;AAAA,OACT;AAEA,MAAA,MAAA,CAAO,kBAAA,GACL,iBAAA,GACA,MAAA,CAAO,cAAA,GACP,MAAA,CAAO,kBACP,MAAA,CAAO,aAAA,GACP,MAAA,CAAO,QAAA,GACP,MAAA,CAAO,YAAA;AAET,MAAA,MAAA,CAAO,qBAAA,GAAwB,oBAAA;AAAA,QAC7B,MAAA,CAAO,kBAAA;AAAA,QACP,eAAA,CAAgB,QAAA;AAAA,QAChB,MAAA,CAAO;AAAA,OACT;AAAA,IACF;AAEA,IAAA,MAAA,CAAO,oBAAoB,WAAA,CAAY;AAAA,MACrC,WAAW,MAAA,CAAO,YAAA;AAAA,MAClB,eAAe,MAAA,CAAO,kBAAA;AAAA,MACtB,GAAA,EAAK,EAAA;AAAA,MACL,uBAAA,EAAyB,EAAA;AAAA,MACzB,qBAAA,EAAuB;AAAA,KACxB,CAAA;AAAA,EACH;AAEA,EAAA,MAAM,sBAAsB,sBAAA,CAAuB;AAAA,IACjD,UAAA;AAAA,IACA,UAAA,EAAY,IAAA;AAAA,IACZ,OAAA;AAAA,IACA,MAAA;AAAA,IACA,YAAY,MAAA,CAAO,UAAA;AAAA,IACnB,cAAc,MAAA,CAAO;AAAA,GACtB,CAAA;AAED,EAAA,MAAA,CAAO,8BAA8B,mBAAA,CAAoB,mBAAA;AACzD,EAAA,MAAA,CAAO,8BAA8B,qBAAA,CAAsB;AAAA,IACzD,qBAAqB,MAAA,CAAO,2BAAA;AAAA,IAC5B,UAAA;AAAA,IACA,cAAc,MAAA,CAAO;AAAA,GACtB,CAAA;AAED,EAAA,MAAA,CAAO,kBAAkB,mBAAA,CAAoB,eAAA;AAC7C,EAAA,MAAA,CAAO,0BAA0B,mBAAA,CAAoB,uBAAA;AAErD,EAAA,IAAI,OAAA,EAAS;AACX,IAAA,IACE,CAAC,iCAAA,IACD,cAAA,KAAmB,SAAA,CAAU,YAAA,EAC7B;AACA,MAAA,MAAA,CAAO,eAAA,GAAkB,SAAS,UAAA,GAAa,EAAA;AAAA,IACjD,CAAA,MAAO;AACL,MAAA,IAAI,yBAAA,GAA4B,6BAAA;AAChC,MAAA,MAAA,CAAO,qCACL,kCAAA,CAAmC;AAAA,QACjC,UAAA,EAAY,IAAA;AAAA,QACZ,MAAA;AAAA,QACA,YAAY,MAAA,CAAO,UAAA;AAAA,QACnB,cAAc,MAAA,CAAO,YAAA;AAAA,QACrB,qBAAqB,MAAA,CAAO,2BAAA;AAAA,QAC5B,6BACE,2BAAA,IACA;AAAA,OACH,CAAA;AAEH,MAAA,IAAI,8BAA8B,MAAA,EAAW;AAC3C,QAAA,yBAAA,GAA4B,MAAA,CAAO,kCAAA;AAAA,MACrC;AAEA,MAAA,MAAM,2BAA2B,sBAAA,CAAuB;AAAA,QACtD,UAAA;AAAA,QACA,UAAA,EAAY,IAAA;AAAA,QACZ,OAAA;AAAA,QACA,MAAA;AAAA,QACA,YAAY,MAAA,CAAO,UAAA;AAAA,QACnB,cAAc,MAAA,CAAO,YAAA;AAAA,QACrB;AAAA,OACD,CAAA;AAED,MAAA,MAAA,CAAO,kBAAkB,wBAAA,CAAyB,eAAA;AAClD,MAAA,MAAA,CAAO,0BACL,wBAAA,CAAyB,uBAAA;AAAA,IAC7B;AAAA,EACF;AAEA,EAAA,MAAA,CAAO,iBAAA,GAAoB,oBAAA;AAAA,IACzB,MAAA,CAAO,YAAA;AAAA,IACP,UAAA,CAAW,QAAA;AAAA,IACX,MAAA,CAAO;AAAA,GACT;AAEA,EAAA,OAAO,MAAA;AACT;AAEO,SAAS,cAAA,CAAe;AAAA,EAC7B,SAAA;AAAA,EACA,OAAA;AAAA,EACA,iBAAA;AAAA,EACA;AACF,CAAA,EAKG;AACD,EAAA,MAAM,cAAA,GAAiB,WAAW,MAAA,CAAO,QAAA;AAEzC,EAAA,MAAM,YAAY,qBAAA,CAAsB;AAAA,IACtC,SAAA;AAAA,IACA,OAAA;AAAA,IACA,SAAA,EAAW,cAAA;AAAA,IACX,OAAA,EAAS;AAAA,GACV,CAAA;AAED,EAAA,IAAI,sBAAsB,MAAA,EAAW;AACnC,IAAA,OAAO,EAAE,SAAA,EAAU;AAAA,EACrB;AAEA,EAAA,MAAM,YAAA,GAA4B;AAAA,IAChC,KAAA,EAAO,iBAAA,GAAoB,CAAA,GAAI,iBAAA,GAAoB,SAAA,CAAU,KAAA;AAAA,IAC7D,cAAc,SAAA,CAAU,YAAA;AAAA,IACxB,eAAe,SAAA,CAAU;AAAA,GAC3B;AAEA,EAAA,OAAO;AAAA,IACL,SAAA;AAAA,IACA;AAAA,GACF;AACF;AAEO,SAAS,oBAAA,CAAqB;AAAA,EACnC,eAAA;AAAA,EACA,QAAA;AAAA,EACA,YAAA;AAAA,EACA,eAAA;AAAA,EACA,cAAA;AAAA,EACA,eAAA;AAAA,EACA,QAAA;AAAA,EACA,YAAA;AAAA,EACA;AACF,CAAA,EAWG;AACD,EAAA,MAAM,qBAAqB,OAAA,CAAQ,MAAA;AAAA,IACjC,YAAA;AAAA,IACA,2BAAA;AAAA,IACA;AAAA,GACF;AACA,EAAA,MAAM,qBAAA,GAAwB,oBAAA;AAAA,IAC5B,kBAAA;AAAA,IACA,eAAA,CAAgB,QAAA;AAAA,IAChB;AAAA,GACF;AAEA,EAAA,MAAM,iBAAA,GACJ,uBAAuB,EAAA,GACnB,kBAAA,GACA,iBACA,eAAA,GACA,aAAA,GACA,WACA,YAAA,GACA,EAAA;AAEN,EAAA,MAAM,oBAAA,GAAuB,oBAAA;AAAA,IAC3B,iBAAA;AAAA,IACA,eAAA,CAAgB,QAAA;AAAA,IAChB;AAAA,GACF;AAEA,EAAA,OAAO;AAAA,IACL,kBAAA;AAAA,IACA,qBAAA;AAAA,IACA,iBAAA;AAAA,IACA;AAAA,GACF;AACF;AAEO,SAAS,yBAAA,CAA0B;AAAA,EACxC,YAAA;AAAA,EACA,UAAA;AAAA,EACA,sBAAA;AAAA,EACA,eAAA;AAAA,EACA,cAAA;AAAA,EACA;AACF,CAAA,EAOG;AACD,EAAA,IAAI,UAAA;AACJ,EAAA,IAAI,sBAAA;AACJ,EAAA,IAAI,oBAAA;AACJ,EAAA,IAAI,eAAA;AAEJ,EAAA,IACE,YAAA,KAAiB,MAAA,IACjB,YAAA,GAAe,CAAA,IACf,mBAAmB,MAAA,EACnB;AACA,IAAA,UAAA,GAAa,YAAA;AACb,IAAA,sBAAA,GAAyB,qBAAA;AAAA,MACvB,UAAA;AAAA,MACA;AAAA,KACF,GACI,YAAA,GACA,sBAAA,CAAuB,MAAA,CAAO,QAAA;AAElC,IAAA,eAAA,GAAkB,sBAAsB,UAAA,EAAY,eAAe,CAAA,GAC/D,YAAA,GACA,gBAAgB,MAAA,CAAO,QAAA;AAE3B,IAAA,oBAAA,GAAuB,qBAAA,CAAsB,gBAAgB,MAAM,CAAA;AAAA,EACrE,CAAA,MAAO;AACL,IAAA,UAAA,GAAa,YAAA,CAAa;AAAA,MACxB,QAAQ,UAAA,CAAW,MAAA;AAAA,MACnB,UAAA,EAAY,IAAA;AAAA,MACZ;AAAA,KACD,CAAA;AACD,IAAA,sBAAA,GAAyB,uBAAuB,MAAA,CAAO,QAAA;AACvD,IAAA,eAAA,GAAkB,gBAAgB,MAAA,CAAO,QAAA;AAAA,EAC3C;AAEA,EAAA,OAAO;AAAA,IACL,UAAA;AAAA,IACA,sBAAA;AAAA,IACA,eAAA;AAAA,IACA,oBAAA;AAAA,IACA;AAAA,GACF;AACF;AAEO,SAAS,sCAAsC,CAAA,EAc/B;AACrB,EAAA,MAAM;AAAA,IACJ,gBAAA;AAAA,IACA,UAAA;AAAA,IACA,eAAA;AAAA,IACA,YAAA;AAAA,IACA,iBAAA;AAAA,IACA,kBAAA;AAAA,IACA,qBAAA;AAAA,IACA,UAAA;AAAA,IACA,MAAA;AAAA,IACA,iBAAA;AAAA,IACA,gBAAA;AAAA,IACA,gBAAA;AAAA,IACA;AAAA,GACF,GAAI,CAAA;AAEJ,EAAA,MAAM,iBAAA,GAAoB,gBAAA,GACtB,gBAAA,CAAiB,aAAA,GAAgB,kBAAA,GACjC,kBAAA;AAEJ,EAAA,MAAM,oBAAA,GAAuB,gBAAA,GACzB,gBAAA,CAAiB,gBAAA,GAAmB,qBAAA,GACpC,qBAAA;AAEJ,EAAA,MAAM,WAAA,GAAc,gBAAA,GAChB,gBAAA,CAAiB,SAAA,GAAY,YAAA,GAC7B,YAAA;AACJ,EAAA,MAAM,gBAAA,GAAmB,gBAAA,GACrB,gBAAA,CAAiB,YAAA,GAAe,iBAAA,GAChC,iBAAA;AAEJ,EAAA,MAAM,iBACJ,aAAA,CAAc;AAAA,IACZ,SAAA,EAAW,WAAA;AAAA,IACX,YAAA,EAAc,gBAAA;AAAA,IACd,YAAY,UAAA,CAAW;AAAA,GACxB,CAAA,IAAK,UAAA;AAER,EAAA,MAAM,OAAA,GAAU,mBACZ,iBAAA,CAAkB;AAAA,IAChB,UAAA;AAAA,IACA,SAAA,EAAW,WAAA;AAAA,IACX,YAAA,EAAc,gBAAA;AAAA,IACd,SAAA,EAAW,UAAA;AAAA,IACX;AAAA,GACD,CAAA,GACD,MAAA;AAEJ,EAAA,MAAM,eAAe,WAAA,CAAY;AAAA,IAC/B,SAAA,EAAW,WAAA;AAAA,IACX,aAAA,EAAe,iBAAA;AAAA,IACf,GAAA,EAAK,oBAAoB,OAAA,GAAU,MAAA;AAAA,IACnC,uBAAA,EAAyB,EAAA;AAAA;AAAA,IACzB,qBAAA,EAAuB;AAAA;AAAA,GACxB,CAAA;AAED,EAAA,MAAM,eAAe,mBAAA,CAAoB;AAAA,IACvC,UAAA;AAAA,IACA,eAAA;AAAA,IACA,SAAA,EAAW,WAAA;AAAA,IACX,YAAA,EAAc,gBAAA;AAAA,IACd,aAAA,EAAe,iBAAA;AAAA,IACf,gBAAA,EAAkB,oBAAA;AAAA,IAClB,gBAAA;AAAA,IACA,uBAAA,EAAyB,EAAA;AAAA;AAAA,IACzB,qBAAA,EAAuB,EAAA;AAAA;AAAA,IACvB,mBAAA,EAAqB,kBAAkB,mBAAA,IAAuB,EAAA;AAAA,IAC9D,MAAA;AAAA,IACA;AAAA,GACD,CAAA;AAED,EAAA,IAAI,4BACF,gBAAA,EAAkB,gBAAA,KAAqB,MAAA,GACnC,gBAAA,CAAiB,mBAAmB,2BAAA,GACpC,2BAAA;AAEN,EAAA,MAAM,8BAA8B,qBAAA,CAAsB;AAAA,IACxD,mBAAA,EAAqB,yBAAA;AAAA,IACrB,UAAA;AAAA,IACA,YAAA,EAAc;AAAA,GACf,CAAA;AAED,EAAA,IAAI,4BAA4B,CAAA,EAAG;AACjC,IAAA,yBAAA,GAA4B,0CAAA;AAAA,MAC1B,UAAA;AAAA,MACA,WAAA;AAAA,MACA;AAAA,KACF;AAAA,EACF;AAEA,EAAA,yBAAA,GAA4B,mCAAA;AAAA,IAC1B,UAAA;AAAA,IACA;AAAA,GACF;AAEA,EAAA,OAAO;AAAA,IACL,WAAA;AAAA,IACA,iBAAA;AAAA,IACA,cAAA;AAAA,IACA,YAAA;AAAA,IACA,YAAA;AAAA,IACA,yBAAA;AAAA,IACA;AAAA,GACF;AACF","file":"increase.js","sourcesContent":["import { maxUint256 } from \"viem\";\n\nimport { DEFAULT_ACCEPTABLE_PRICE_IMPACT_BUFFER } from \"configs/factors\";\nimport {\n  capPositionImpactUsdByMaxImpactPool,\n  capPositionImpactUsdByMaxPriceImpactFactor,\n  getPositionFee,\n  getPriceImpactForPosition,\n  getTotalSwapVolumeFromSwapStats,\n} from \"domain/executionFee\";\nimport {\n  ExternalSwapQuote,\n  ExternalSwapQuoteParams,\n} from \"domain/externalSwap/types\";\nimport { IncreasePositionAmounts } from \"domain/increase/types\";\nimport { MarketInfo, MarketsInfoData } from \"domain/markets/types\";\nimport { OrderType } from \"domain/orders/types\";\nimport { PositionInfo } from \"domain/positions/types\";\nimport { NextPositionValues } from \"domain/positions/types\";\nimport {\n  getEntryPrice,\n  getLeverage,\n  getLiquidationPrice,\n  getPositionPnlUsd,\n  getPriceImpactDiffUsd,\n} from \"domain/positions/utils\";\nimport {\n  getAcceptablePriceInfo,\n  getDefaultAcceptablePriceImpactBps,\n} from \"domain/pricing/acceptablePrice\";\nimport { TriggerThresholdType } from \"domain/pricing/types\";\nimport { getMarkPrice, getOrderThresholdType } from \"domain/pricing/utils\";\nimport { UserReferralInfo } from \"domain/referrals/types\";\nimport {\n  getSwapAmountsByFromValue,\n  getSwapAmountsByToValue,\n} from \"domain/swap/swapValues\";\nimport { ExternalSwapStrategy, NoSwapStrategy } from \"domain/swap/types\";\nimport { TokensRatio } from \"domain/swap/types\";\nimport { FindSwapPath, SwapOptimizationOrderArray } from \"domain/swap/types\";\nimport { getTokensRatioByPrice } from \"domain/swap/utils\";\nimport { TokenData } from \"domain/tokens/types\";\nimport {\n  convertToTokenAmount,\n  convertToUsd,\n  getIsEquivalentTokens,\n} from \"domain/tokens/utils\";\nimport { bigMath } from \"lib/bigmath\";\nimport { BASIS_POINTS_DIVISOR_BIGINT } from \"lib/numbers\";\nimport { applyFactor } from \"lib/numbers\";\n\ntype IncreasePositionParams = {\n  marketInfo: MarketInfo;\n  indexToken: TokenData;\n  initialCollateralToken: TokenData;\n  collateralToken: TokenData;\n  isLong: boolean;\n  initialCollateralAmount: bigint | undefined;\n  position: PositionInfo | undefined;\n  externalSwapQuote: ExternalSwapQuote | undefined;\n  indexTokenAmount: bigint | undefined;\n  leverage?: bigint;\n  triggerPrice?: bigint;\n  limitOrderType?: IncreasePositionAmounts[\"limitOrderType\"];\n  fixedAcceptablePriceImpactBps?: bigint;\n  acceptablePriceImpactBuffer?: number;\n  userReferralInfo: UserReferralInfo | undefined;\n  strategy: \"leverageBySize\" | \"leverageByCollateral\" | \"independent\";\n  findSwapPath: FindSwapPath;\n  uiFeeFactor: bigint;\n  marketsInfoData: MarketsInfoData | undefined;\n  chainId: number;\n  externalSwapQuoteParams: ExternalSwapQuoteParams | undefined;\n  isSetAcceptablePriceImpactEnabled: boolean;\n};\n\nexport function getIncreasePositionAmounts(\n  p: IncreasePositionParams\n): IncreasePositionAmounts {\n  const {\n    marketInfo,\n    indexToken,\n    initialCollateralToken,\n    collateralToken,\n    initialCollateralAmount,\n    indexTokenAmount,\n    isLong,\n    leverage,\n    triggerPrice,\n    limitOrderType,\n    position,\n    fixedAcceptablePriceImpactBps,\n    acceptablePriceImpactBuffer,\n    externalSwapQuote,\n    findSwapPath,\n    userReferralInfo,\n    uiFeeFactor,\n    strategy,\n    marketsInfoData,\n    chainId,\n    externalSwapQuoteParams,\n    isSetAcceptablePriceImpactEnabled,\n  } = p;\n\n  const swapStrategy: NoSwapStrategy = {\n    type: \"noSwap\",\n    externalSwapQuote: undefined,\n    swapPathStats: undefined,\n    amountIn: 0n,\n    amountOut: 0n,\n    usdIn: 0n,\n    usdOut: 0n,\n    priceIn: 0n,\n    priceOut: 0n,\n    feesUsd: 0n,\n  };\n\n  const values: IncreasePositionAmounts = {\n    initialCollateralAmount: 0n,\n    initialCollateralUsd: 0n,\n\n    collateralDeltaAmount: 0n,\n    collateralDeltaUsd: 0n,\n\n    swapStrategy,\n\n    indexTokenAmount: 0n,\n\n    sizeDeltaUsd: 0n,\n    sizeDeltaInTokens: 0n,\n\n    estimatedLeverage: 0n,\n\n    indexPrice: 0n,\n    initialCollateralPrice: 0n,\n    collateralPrice: 0n,\n    triggerPrice: 0n,\n    acceptablePrice: 0n,\n    acceptablePriceDeltaBps: 0n,\n    recommendedAcceptablePriceDeltaBps: 0n,\n\n    positionFeeUsd: 0n,\n    uiFeeUsd: 0n,\n    swapUiFeeUsd: 0n,\n    feeDiscountUsd: 0n,\n    borrowingFeeUsd: 0n,\n    fundingFeeUsd: 0n,\n    positionPriceImpactDeltaUsd: 0n,\n    potentialPriceImpactDiffUsd: 0n,\n\n    limitOrderType: limitOrderType,\n    triggerThresholdType: undefined,\n  };\n\n  const isLimit = limitOrderType !== undefined;\n\n  const swapOptimizationOrder: SwapOptimizationOrderArray | undefined = isLimit\n    ? [\"length\", \"liquidity\"]\n    : undefined;\n\n  const prices = getIncreasePositionPrices({\n    triggerPrice,\n    indexToken,\n    initialCollateralToken,\n    collateralToken,\n    limitOrderType,\n    isLong,\n  });\n\n  values.indexPrice = prices.indexPrice;\n  values.initialCollateralPrice = prices.initialCollateralPrice;\n  values.collateralPrice = prices.collateralPrice;\n  values.triggerPrice = prices.triggerPrice;\n  values.triggerThresholdType = prices.triggerThresholdType;\n\n  values.borrowingFeeUsd = position?.pendingBorrowingFeesUsd || 0n;\n  values.fundingFeeUsd = position?.pendingFundingFeesUsd || 0n;\n\n  if (\n    values.indexPrice <= 0 ||\n    values.initialCollateralPrice <= 0 ||\n    values.collateralPrice <= 0\n  ) {\n    return values;\n  }\n\n  // Size and collateral\n  if (\n    strategy === \"leverageByCollateral\" &&\n    leverage !== undefined &&\n    initialCollateralAmount !== undefined &&\n    initialCollateralAmount > 0\n  ) {\n    values.estimatedLeverage = leverage;\n\n    values.initialCollateralAmount = initialCollateralAmount;\n    values.initialCollateralUsd = convertToUsd(\n      initialCollateralAmount,\n      initialCollateralToken.decimals,\n      values.initialCollateralPrice\n    )!;\n\n    if (externalSwapQuote) {\n      const swapStrategy: ExternalSwapStrategy = {\n        type: \"externalSwap\",\n        externalSwapQuote,\n        swapPathStats: undefined,\n        ...externalSwapQuote,\n      };\n\n      values.swapStrategy = swapStrategy;\n    } else {\n      const swapAmounts = getSwapAmountsByFromValue({\n        tokenIn: initialCollateralToken,\n        tokenOut: collateralToken,\n        amountIn: initialCollateralAmount,\n        isLimit: false,\n        findSwapPath,\n        uiFeeFactor,\n        swapOptimizationOrder,\n        marketsInfoData,\n        chainId,\n        externalSwapQuoteParams,\n      });\n\n      values.swapStrategy = swapAmounts.swapStrategy;\n    }\n\n    const swapAmountOut = values.swapStrategy.amountOut;\n    const baseCollateralUsd = convertToUsd(\n      swapAmountOut,\n      collateralToken.decimals,\n      values.collateralPrice\n    )!;\n    const baseSizeDeltaUsd = bigMath.mulDiv(\n      baseCollateralUsd,\n      leverage,\n      BASIS_POINTS_DIVISOR_BIGINT\n    );\n    const { balanceWasImproved } = getPriceImpactForPosition(\n      marketInfo,\n      baseSizeDeltaUsd,\n      isLong\n    );\n    const basePositionFeeInfo = getPositionFee(\n      marketInfo,\n      baseSizeDeltaUsd,\n      balanceWasImproved,\n      userReferralInfo\n    );\n    const baseUiFeeUsd = applyFactor(baseSizeDeltaUsd, uiFeeFactor);\n    const totalSwapVolumeUsd = getTotalSwapVolumeFromSwapStats(\n      values.swapStrategy.swapPathStats?.swapSteps\n    );\n    values.swapUiFeeUsd = applyFactor(totalSwapVolumeUsd, uiFeeFactor);\n\n    values.sizeDeltaUsd = bigMath.mulDiv(\n      baseCollateralUsd -\n        basePositionFeeInfo.positionFeeUsd -\n        baseUiFeeUsd -\n        values.swapUiFeeUsd,\n      leverage,\n      BASIS_POINTS_DIVISOR_BIGINT\n    );\n\n    values.indexTokenAmount = convertToTokenAmount(\n      values.sizeDeltaUsd,\n      indexToken.decimals,\n      values.indexPrice\n    )!;\n\n    const positionFeeInfo = getPositionFee(\n      marketInfo,\n      values.sizeDeltaUsd,\n      balanceWasImproved,\n      userReferralInfo\n    );\n    values.positionFeeUsd = positionFeeInfo.positionFeeUsd;\n    values.feeDiscountUsd = positionFeeInfo.discountUsd;\n    values.uiFeeUsd = applyFactor(values.sizeDeltaUsd, uiFeeFactor);\n\n    values.collateralDeltaUsd =\n      baseCollateralUsd -\n      values.positionFeeUsd -\n      values.borrowingFeeUsd -\n      values.fundingFeeUsd -\n      values.uiFeeUsd -\n      values.swapUiFeeUsd;\n\n    values.collateralDeltaAmount = convertToTokenAmount(\n      values.collateralDeltaUsd,\n      collateralToken.decimals,\n      values.collateralPrice\n    )!;\n  } else if (\n    strategy === \"leverageBySize\" &&\n    leverage !== undefined &&\n    indexTokenAmount !== undefined &&\n    indexTokenAmount > 0\n  ) {\n    values.estimatedLeverage = leverage;\n    values.indexTokenAmount = indexTokenAmount;\n    values.sizeDeltaUsd = convertToUsd(\n      indexTokenAmount,\n      indexToken.decimals,\n      values.indexPrice\n    )!;\n\n    const { balanceWasImproved } = getPriceImpactForPosition(\n      marketInfo,\n      values.sizeDeltaUsd,\n      isLong\n    );\n\n    const positionFeeInfo = getPositionFee(\n      marketInfo,\n      values.sizeDeltaUsd,\n      balanceWasImproved,\n      userReferralInfo\n    );\n\n    values.positionFeeUsd = positionFeeInfo.positionFeeUsd;\n    values.feeDiscountUsd = positionFeeInfo.discountUsd;\n    values.uiFeeUsd = applyFactor(values.sizeDeltaUsd, uiFeeFactor);\n\n    const { collateralDeltaUsd, collateralDeltaAmount, baseCollateralAmount } =\n      leverageBySizeValues({\n        collateralToken,\n        leverage,\n        sizeDeltaUsd: values.sizeDeltaUsd,\n        collateralPrice: values.collateralPrice,\n        uiFeeFactor,\n        positionFeeUsd: values.positionFeeUsd,\n        borrowingFeeUsd: values.borrowingFeeUsd,\n        fundingFeeUsd: values.fundingFeeUsd,\n        uiFeeUsd: values.uiFeeUsd,\n        swapUiFeeUsd: values.swapUiFeeUsd,\n      });\n\n    values.collateralDeltaUsd = collateralDeltaUsd;\n    values.collateralDeltaAmount = collateralDeltaAmount;\n\n    if (externalSwapQuote) {\n      const swapStrategy: ExternalSwapStrategy = {\n        type: \"externalSwap\",\n        externalSwapQuote,\n        swapPathStats: undefined,\n        ...externalSwapQuote,\n      };\n\n      values.swapStrategy = swapStrategy;\n    } else {\n      const swapAmounts = getSwapAmountsByToValue({\n        tokenIn: initialCollateralToken,\n        tokenOut: collateralToken,\n        amountOut: baseCollateralAmount,\n        isLimit: false,\n        findSwapPath,\n        uiFeeFactor,\n        marketsInfoData,\n        chainId,\n        externalSwapQuoteParams,\n      });\n      values.swapStrategy = swapAmounts.swapStrategy;\n    }\n\n    const swapAmountIn = values.swapStrategy.amountIn;\n\n    values.initialCollateralAmount = swapAmountIn;\n    values.initialCollateralUsd = convertToUsd(\n      values.initialCollateralAmount,\n      initialCollateralToken.decimals,\n      values.initialCollateralPrice\n    )!;\n  } else if (strategy === \"independent\") {\n    if (indexTokenAmount !== undefined && indexTokenAmount > 0) {\n      values.indexTokenAmount = indexTokenAmount;\n      values.sizeDeltaUsd = convertToUsd(\n        indexTokenAmount,\n        indexToken.decimals,\n        values.indexPrice\n      )!;\n\n      const { balanceWasImproved } = getPriceImpactForPosition(\n        marketInfo,\n        values.sizeDeltaUsd,\n        isLong\n      );\n\n      const positionFeeInfo = getPositionFee(\n        marketInfo,\n        values.sizeDeltaUsd,\n        balanceWasImproved,\n        userReferralInfo\n      );\n      values.positionFeeUsd = positionFeeInfo.positionFeeUsd;\n      values.feeDiscountUsd = positionFeeInfo.discountUsd;\n      values.uiFeeUsd = applyFactor(values.sizeDeltaUsd, uiFeeFactor);\n    }\n\n    if (initialCollateralAmount !== undefined && initialCollateralAmount > 0) {\n      values.initialCollateralAmount = initialCollateralAmount;\n      values.initialCollateralUsd = convertToUsd(\n        initialCollateralAmount,\n        initialCollateralToken.decimals,\n        values.initialCollateralPrice\n      )!;\n\n      if (externalSwapQuote) {\n        const swapStrategy: ExternalSwapStrategy = {\n          type: \"externalSwap\",\n          externalSwapQuote,\n          swapPathStats: undefined,\n          ...externalSwapQuote,\n        };\n\n        values.swapStrategy = swapStrategy;\n      } else {\n        const swapAmounts = getSwapAmountsByFromValue({\n          tokenIn: initialCollateralToken,\n          tokenOut: collateralToken,\n          amountIn: initialCollateralAmount,\n          isLimit: false,\n          findSwapPath,\n          uiFeeFactor,\n          swapOptimizationOrder,\n          marketsInfoData,\n          chainId,\n          externalSwapQuoteParams,\n        });\n        values.swapStrategy = swapAmounts.swapStrategy;\n      }\n\n      const swapAmountIn = values.swapStrategy.amountIn;\n      const baseCollateralUsd = convertToUsd(\n        swapAmountIn,\n        initialCollateralToken.decimals,\n        values.initialCollateralPrice\n      )!;\n\n      values.collateralDeltaUsd =\n        baseCollateralUsd -\n        values.positionFeeUsd -\n        values.borrowingFeeUsd -\n        values.fundingFeeUsd -\n        values.uiFeeUsd -\n        values.swapUiFeeUsd;\n\n      values.collateralDeltaAmount = convertToTokenAmount(\n        values.collateralDeltaUsd,\n        collateralToken.decimals,\n        values.collateralPrice\n      )!;\n    }\n\n    values.estimatedLeverage = getLeverage({\n      sizeInUsd: values.sizeDeltaUsd,\n      collateralUsd: values.collateralDeltaUsd,\n      pnl: 0n,\n      pendingBorrowingFeesUsd: 0n,\n      pendingFundingFeesUsd: 0n,\n    });\n  }\n\n  const acceptablePriceInfo = getAcceptablePriceInfo({\n    marketInfo,\n    isIncrease: true,\n    isLimit,\n    isLong,\n    indexPrice: values.indexPrice,\n    sizeDeltaUsd: values.sizeDeltaUsd,\n  });\n\n  values.positionPriceImpactDeltaUsd = acceptablePriceInfo.priceImpactDeltaUsd;\n  values.potentialPriceImpactDiffUsd = getPriceImpactDiffUsd({\n    totalImpactDeltaUsd: values.positionPriceImpactDeltaUsd,\n    marketInfo,\n    sizeDeltaUsd: values.sizeDeltaUsd,\n  });\n\n  values.acceptablePrice = acceptablePriceInfo.acceptablePrice;\n  values.acceptablePriceDeltaBps = acceptablePriceInfo.acceptablePriceDeltaBps;\n\n  if (isLimit) {\n    if (\n      !isSetAcceptablePriceImpactEnabled ||\n      limitOrderType === OrderType.StopIncrease\n    ) {\n      values.acceptablePrice = isLong ? maxUint256 : 0n;\n    } else {\n      let maxNegativePriceImpactBps = fixedAcceptablePriceImpactBps;\n      values.recommendedAcceptablePriceDeltaBps =\n        getDefaultAcceptablePriceImpactBps({\n          isIncrease: true,\n          isLong,\n          indexPrice: values.indexPrice,\n          sizeDeltaUsd: values.sizeDeltaUsd,\n          priceImpactDeltaUsd: values.positionPriceImpactDeltaUsd,\n          acceptablePriceImapctBuffer:\n            acceptablePriceImpactBuffer ||\n            DEFAULT_ACCEPTABLE_PRICE_IMPACT_BUFFER,\n        });\n\n      if (maxNegativePriceImpactBps === undefined) {\n        maxNegativePriceImpactBps = values.recommendedAcceptablePriceDeltaBps;\n      }\n\n      const limitAcceptablePriceInfo = getAcceptablePriceInfo({\n        marketInfo,\n        isIncrease: true,\n        isLimit,\n        isLong,\n        indexPrice: values.indexPrice,\n        sizeDeltaUsd: values.sizeDeltaUsd,\n        maxNegativePriceImpactBps,\n      });\n\n      values.acceptablePrice = limitAcceptablePriceInfo.acceptablePrice;\n      values.acceptablePriceDeltaBps =\n        limitAcceptablePriceInfo.acceptablePriceDeltaBps;\n    }\n  }\n\n  values.sizeDeltaInTokens = convertToTokenAmount(\n    values.sizeDeltaUsd,\n    indexToken.decimals,\n    values.indexPrice\n  )!;\n\n  return values;\n}\n\nexport function getTokensRatio({\n  fromToken,\n  toToken,\n  triggerRatioValue,\n  markPrice,\n}: {\n  fromToken: TokenData;\n  toToken: TokenData;\n  triggerRatioValue: bigint;\n  markPrice: bigint;\n}) {\n  const fromTokenPrice = fromToken?.prices.minPrice;\n\n  const markRatio = getTokensRatioByPrice({\n    fromToken,\n    toToken,\n    fromPrice: fromTokenPrice,\n    toPrice: markPrice,\n  });\n\n  if (triggerRatioValue === undefined) {\n    return { markRatio };\n  }\n\n  const triggerRatio: TokensRatio = {\n    ratio: triggerRatioValue > 0 ? triggerRatioValue : markRatio.ratio,\n    largestToken: markRatio.largestToken,\n    smallestToken: markRatio.smallestToken,\n  };\n\n  return {\n    markRatio,\n    triggerRatio,\n  };\n}\n\nexport function leverageBySizeValues({\n  collateralToken,\n  leverage,\n  sizeDeltaUsd,\n  collateralPrice,\n  positionFeeUsd,\n  borrowingFeeUsd,\n  uiFeeUsd,\n  swapUiFeeUsd,\n  fundingFeeUsd,\n}: {\n  collateralToken: TokenData;\n  leverage: bigint;\n  sizeDeltaUsd: bigint;\n  collateralPrice: bigint;\n  uiFeeFactor: bigint;\n  positionFeeUsd: bigint;\n  fundingFeeUsd: bigint;\n  borrowingFeeUsd: bigint;\n  uiFeeUsd: bigint;\n  swapUiFeeUsd: bigint;\n}) {\n  const collateralDeltaUsd = bigMath.mulDiv(\n    sizeDeltaUsd,\n    BASIS_POINTS_DIVISOR_BIGINT,\n    leverage\n  );\n  const collateralDeltaAmount = convertToTokenAmount(\n    collateralDeltaUsd,\n    collateralToken.decimals,\n    collateralPrice\n  )!;\n\n  const baseCollateralUsd =\n    collateralDeltaUsd !== 0n\n      ? collateralDeltaUsd +\n        positionFeeUsd +\n        borrowingFeeUsd +\n        fundingFeeUsd +\n        uiFeeUsd +\n        swapUiFeeUsd\n      : 0n;\n\n  const baseCollateralAmount = convertToTokenAmount(\n    baseCollateralUsd,\n    collateralToken.decimals,\n    collateralPrice\n  )!;\n\n  return {\n    collateralDeltaUsd,\n    collateralDeltaAmount,\n    baseCollateralUsd,\n    baseCollateralAmount,\n  };\n}\n\nexport function getIncreasePositionPrices({\n  triggerPrice,\n  indexToken,\n  initialCollateralToken,\n  collateralToken,\n  limitOrderType,\n  isLong,\n}: {\n  triggerPrice?: bigint;\n  indexToken: TokenData;\n  initialCollateralToken: TokenData;\n  collateralToken: TokenData;\n  isLong: boolean;\n  limitOrderType?: IncreasePositionAmounts[\"limitOrderType\"];\n}) {\n  let indexPrice: bigint;\n  let initialCollateralPrice: bigint;\n  let triggerThresholdType: TriggerThresholdType | undefined;\n  let collateralPrice: bigint;\n\n  if (\n    triggerPrice !== undefined &&\n    triggerPrice > 0 &&\n    limitOrderType !== undefined\n  ) {\n    indexPrice = triggerPrice;\n    initialCollateralPrice = getIsEquivalentTokens(\n      indexToken,\n      initialCollateralToken\n    )\n      ? triggerPrice\n      : initialCollateralToken.prices.minPrice;\n\n    collateralPrice = getIsEquivalentTokens(indexToken, collateralToken)\n      ? triggerPrice\n      : collateralToken.prices.minPrice;\n\n    triggerThresholdType = getOrderThresholdType(limitOrderType, isLong);\n  } else {\n    indexPrice = getMarkPrice({\n      prices: indexToken.prices,\n      isIncrease: true,\n      isLong,\n    });\n    initialCollateralPrice = initialCollateralToken.prices.minPrice;\n    collateralPrice = collateralToken.prices.minPrice;\n  }\n\n  return {\n    indexPrice,\n    initialCollateralPrice,\n    collateralPrice,\n    triggerThresholdType,\n    triggerPrice,\n  };\n}\n\nexport function getNextPositionValuesForIncreaseTrade(p: {\n  existingPosition?: PositionInfo;\n  marketInfo: MarketInfo;\n  collateralToken: TokenData;\n  positionPriceImpactDeltaUsd: bigint;\n  sizeDeltaUsd: bigint;\n  sizeDeltaInTokens: bigint;\n  collateralDeltaUsd: bigint;\n  collateralDeltaAmount: bigint;\n  indexPrice: bigint;\n  isLong: boolean;\n  showPnlInLeverage: boolean;\n  minCollateralUsd: bigint;\n  userReferralInfo: UserReferralInfo | undefined;\n}): NextPositionValues {\n  const {\n    existingPosition,\n    marketInfo,\n    collateralToken,\n    sizeDeltaUsd,\n    sizeDeltaInTokens,\n    collateralDeltaUsd,\n    collateralDeltaAmount,\n    indexPrice,\n    isLong,\n    showPnlInLeverage,\n    minCollateralUsd,\n    userReferralInfo,\n    positionPriceImpactDeltaUsd,\n  } = p;\n\n  const nextCollateralUsd = existingPosition\n    ? existingPosition.collateralUsd + collateralDeltaUsd\n    : collateralDeltaUsd;\n\n  const nextCollateralAmount = existingPosition\n    ? existingPosition.collateralAmount + collateralDeltaAmount\n    : collateralDeltaAmount;\n\n  const nextSizeUsd = existingPosition\n    ? existingPosition.sizeInUsd + sizeDeltaUsd\n    : sizeDeltaUsd;\n  const nextSizeInTokens = existingPosition\n    ? existingPosition.sizeInTokens + sizeDeltaInTokens\n    : sizeDeltaInTokens;\n\n  const nextEntryPrice =\n    getEntryPrice({\n      sizeInUsd: nextSizeUsd,\n      sizeInTokens: nextSizeInTokens,\n      indexToken: marketInfo.indexToken,\n    }) ?? indexPrice;\n\n  const nextPnl = existingPosition\n    ? getPositionPnlUsd({\n        marketInfo,\n        sizeInUsd: nextSizeUsd,\n        sizeInTokens: nextSizeInTokens,\n        markPrice: indexPrice,\n        isLong,\n      })\n    : undefined;\n\n  const nextLeverage = getLeverage({\n    sizeInUsd: nextSizeUsd,\n    collateralUsd: nextCollateralUsd,\n    pnl: showPnlInLeverage ? nextPnl : undefined,\n    pendingBorrowingFeesUsd: 0n, // deducted on order\n    pendingFundingFeesUsd: 0n, // deducted on order\n  });\n\n  const nextLiqPrice = getLiquidationPrice({\n    marketInfo,\n    collateralToken,\n    sizeInUsd: nextSizeUsd,\n    sizeInTokens: nextSizeInTokens,\n    collateralUsd: nextCollateralUsd,\n    collateralAmount: nextCollateralAmount,\n    minCollateralUsd,\n    pendingBorrowingFeesUsd: 0n, // deducted on order\n    pendingFundingFeesUsd: 0n, // deducted on order\n    pendingImpactAmount: existingPosition?.pendingImpactAmount ?? 0n,\n    isLong: isLong,\n    userReferralInfo,\n  });\n\n  let nextPendingImpactDeltaUsd =\n    existingPosition?.pendingImpactUsd !== undefined\n      ? existingPosition.pendingImpactUsd + positionPriceImpactDeltaUsd\n      : positionPriceImpactDeltaUsd;\n\n  const potentialPriceImpactDiffUsd = getPriceImpactDiffUsd({\n    totalImpactDeltaUsd: nextPendingImpactDeltaUsd,\n    marketInfo,\n    sizeDeltaUsd: nextSizeUsd,\n  });\n\n  if (nextPendingImpactDeltaUsd > 0) {\n    nextPendingImpactDeltaUsd = capPositionImpactUsdByMaxPriceImpactFactor(\n      marketInfo,\n      nextSizeUsd,\n      nextPendingImpactDeltaUsd\n    );\n  }\n\n  nextPendingImpactDeltaUsd = capPositionImpactUsdByMaxImpactPool(\n    marketInfo,\n    nextPendingImpactDeltaUsd\n  );\n\n  return {\n    nextSizeUsd,\n    nextCollateralUsd,\n    nextEntryPrice,\n    nextLeverage,\n    nextLiqPrice,\n    nextPendingImpactDeltaUsd,\n    potentialPriceImpactDiffUsd,\n  };\n}\n"]}