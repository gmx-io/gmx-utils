{"version":3,"sources":["../../../../../src/domain/uiFeeReceiver/uiFeeReceiver.ts"],"names":[],"mappings":";;AAEA,MAAM,OAAA,GAAU,IAAA;AAChB,MAAM,MAAA,GAAS,UAAA;AAaR,SAAS,cAAA,GAAiB;AAC/B,EAAA,OAAO,IAAA,CAAK,KAAA,CAAM,IAAA,CAAK,MAAA,EAAO,GAAI,GAAA,GAAM,GAAG,CAAA,CACxC,QAAA,CAAS,EAAE,CAAA,CACX,QAAA,CAAS,GAAG,GAAG,CAAA;AACpB;AAEO,SAAS,uBAAA,CAAwB;AAAA,EACtC;AACF,CAAA,EAEG;AACD,EAAA,MAAM,SAAS,cAAA,EAAe;AAE9B,EAAA,MAAM,qBAAqB,aAAA,CAAc,QAAA,CAAS,EAAE,CAAA,CAAE,QAAA,CAAS,GAAG,GAAG,CAAA;AAErE,EAAA,MAAM,MAAA,GAAS,IAAA,CAAK,MAAA,CAAO,EAAE,CAAA;AAC7B,EAAA,MAAM,YAAA,GAAe,IAAA;AAErB,EAAA,OAAO,CAAA,EAAG,MAAM,CAAA,EAAG,MAAM,CAAA,EAAG,YAAY,CAAA,EAAG,kBAAkB,CAAA,EAAG,MAAM,CAAA,EAAG,OAAO,CAAA,CAAA;AAClF;AAEO,SAAS,wBACd,OAAA,EACsE;AACtE,EAAA,MAAM,UAAA,GAAa,OAAA,CAAQ,KAAA,CAAM,CAAC,CAAA;AAClC,EAAA,MAAM,MAAA,GAAS,UAAA,CAAW,KAAA,CAAM,EAAA,EAAI,EAAE,CAAA;AACtC,EAAA,MAAM,SAAA,GAAY,UAAA,CAAW,KAAA,CAAM,EAAA,EAAI,EAAE,CAAA,KAAM,IAAA;AAE/C,EAAA,IAAI,CAAC,wBAAA,CAAyB,OAAO,CAAA,IAAK,WAAW,MAAA,EAAQ;AAC3D,IAAA;AAAA,EACF;AAEA,EAAA,MAAM,gBAAgB,QAAA,CAAS,UAAA,CAAW,MAAM,EAAA,EAAI,EAAE,GAAG,EAAE,CAAA;AAE3D,EAAA,OAAO,EAAE,MAAA,EAAQ,aAAA,EAAe,SAAA,EAAU;AAC5C;AAEO,SAAS,yBAAyB,OAAA,EAAiB;AACxD,EAAA,OACE,SAAA,CAAU,OAAO,CAAA,IAAK,OAAA,CAAQ,aAAY,CAAE,UAAA,CAAW,MAAA,CAAO,WAAA,EAAa,CAAA;AAE/E;AAEO,SAAS,yBAAA,CACd,eACA,SAAA,EACQ;AACR,EAAA,MAAM,cAAA,GAAiB,YAAY,IAAA,GAAO,IAAA;AAE1C,EAAA,OAAO,GAAG,aAAA,CAAc,KAAA;AAAA,IACtB,CAAA;AAAA,IACA,EAAA,GAAK;AAAA,GACN,GAAG,cAAc,CAAA,EAAG,cAAc,KAAA,CAAM,EAAA,GAAK,CAAC,CAAC,CAAA,CAAA;AAClD","file":"uiFeeReceiver.js","sourcesContent":["import { isAddress } from \"viem\";\n\nconst VERSION = \"01\";\nconst PREFIX = \"0xff0000\";\n\n/**\n * Ui fee receiver structure:\n * 0-3 (4) bytes (0-7 chars) - PREFIX\n * 4-15 (12) bytes (8-32 chars) - 12 bytes buffer\n * 16 (1) byte (33-34 chars) - isExpress flag\n * 17 (1) byte (35-36 chars) - numberOfParts (hex encoded)\n * 18-19 (2) bytes (37-40 chars) - twapId\n * 20 (1) byte (41-42 chars) - VERSION\n *\n * Total: 0x + 20 bytes (41 hex characters)\n */\nexport function generateTwapId() {\n  return Math.floor(Math.random() * 256 * 256)\n    .toString(16)\n    .padStart(4, \"0\");\n}\n\nexport function createTwapUiFeeReceiver({\n  numberOfParts,\n}: {\n  numberOfParts: number;\n}) {\n  const twapId = generateTwapId();\n\n  const numberOfPartsInHex = numberOfParts.toString(16).padStart(2, \"0\");\n\n  const buffer = \"00\".repeat(12);\n  const isExpressHex = \"00\";\n\n  return `${PREFIX}${buffer}${isExpressHex}${numberOfPartsInHex}${twapId}${VERSION}`;\n}\n\nexport function decodeTwapUiFeeReceiver(\n  address: string\n): { twapId: string; numberOfParts: number; isExpress: boolean } | void {\n  const byteString = address.slice(2);\n  const twapId = byteString.slice(34, 38);\n  const isExpress = byteString.slice(30, 32) === \"01\";\n\n  if (!isValidTwapUiFeeReceiver(address) || twapId === \"0000\") {\n    return;\n  }\n\n  const numberOfParts = parseInt(byteString.slice(32, 34), 16);\n\n  return { twapId, numberOfParts, isExpress };\n}\n\nexport function isValidTwapUiFeeReceiver(address: string) {\n  return (\n    isAddress(address) && address.toLowerCase().startsWith(PREFIX.toLowerCase())\n  );\n}\n\nexport function setUiFeeReceiverIsExpress(\n  uiFeeReceiver: string,\n  isExpress: boolean\n): string {\n  const isExpressInHex = isExpress ? \"01\" : \"00\";\n\n  return `${uiFeeReceiver.slice(\n    0,\n    16 * 2\n  )}${isExpressInHex}${uiFeeReceiver.slice(17 * 2)}`;\n}\n"]}