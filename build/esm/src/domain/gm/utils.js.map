{"version":3,"sources":["../../../../../src/domain/gm/utils.ts"],"names":["glvTokenAmount","usdValue"],"mappings":"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","file":"utils.js","sourcesContent":["import { getSwapFee } from \"domain/executionFee\";\nimport { GlvInfo } from \"domain/glv/types\";\nimport { DepositAmounts } from \"domain/gm/types\";\nimport { MarketInfo } from \"domain/markets/types\";\nimport {\n  marketTokenAmountToUsd,\n  usdToMarketTokenAmount,\n} from \"domain/markets/utils\";\nimport {\n  applySwapImpactWithCap,\n  getPriceImpactForSwap,\n} from \"domain/pricing/priceImpact\";\nimport { TokenData } from \"domain/tokens/types\";\nimport {\n  convertToTokenAmount,\n  convertToUsd,\n  getMidPrice,\n} from \"domain/tokens/utils\";\nimport { bigMath } from \"lib/bigmath\";\nimport { applyFactor } from \"lib/numbers\";\n\nimport { WithdrawalAmounts } from \"./types\";\n\nexport function getDepositAmounts(p: {\n  marketInfo: MarketInfo;\n  marketToken: TokenData;\n  longToken: TokenData;\n  shortToken: TokenData;\n  longTokenAmount: bigint;\n  shortTokenAmount: bigint;\n  glvTokenAmount?: bigint;\n  glvToken?: TokenData;\n  marketTokenAmount: bigint;\n  strategy: \"byCollaterals\" | \"byMarketToken\";\n  includeLongToken: boolean;\n  includeShortToken: boolean;\n  uiFeeFactor: bigint;\n  forShift?: boolean;\n  isMarketTokenDeposit: boolean;\n  glvInfo?: GlvInfo;\n}): DepositAmounts {\n  const {\n    marketInfo,\n    marketToken,\n    longToken,\n    shortToken,\n    longTokenAmount,\n    shortTokenAmount,\n    glvTokenAmount,\n    marketTokenAmount,\n    strategy,\n    includeLongToken,\n    includeShortToken,\n    uiFeeFactor,\n    isMarketTokenDeposit,\n    glvInfo,\n    glvToken,\n  } = p;\n\n  const longTokenPrice = longToken && getMidPrice(longToken.prices);\n  const shortTokenPrice = shortToken && getMidPrice(shortToken.prices);\n\n  const values: DepositAmounts = {\n    longTokenAmount: 0n,\n    longTokenUsd: 0n,\n    shortTokenAmount: 0n,\n    shortTokenUsd: 0n,\n    marketTokenAmount: 0n,\n    glvTokenAmount: 0n,\n    glvTokenUsd: 0n,\n    marketTokenUsd: 0n,\n    swapFeeUsd: 0n,\n    uiFeeUsd: 0n,\n    swapPriceImpactDeltaUsd: 0n,\n  };\n\n  if (strategy === \"byCollaterals\") {\n    if (\n      longTokenAmount == 0n &&\n      shortTokenAmount == 0n &&\n      marketTokenAmount == 0n\n    ) {\n      return values;\n    }\n\n    values.longTokenAmount = longTokenAmount;\n    values.longTokenUsd = convertToUsd(\n      longTokenAmount,\n      longToken.decimals,\n      longTokenPrice\n    )!;\n\n    values.shortTokenAmount = shortTokenAmount;\n    values.shortTokenUsd = convertToUsd(\n      shortTokenAmount,\n      shortToken.decimals,\n      shortTokenPrice\n    )!;\n\n    if (isMarketTokenDeposit && glvInfo && marketToken && glvToken) {\n      const marketTokenUsd = convertToUsd(\n        marketTokenAmount,\n        marketToken.decimals,\n        marketToken.prices.minPrice\n      )!;\n      const glvTokenAmount =\n        convertToTokenAmount(\n          marketTokenUsd,\n          glvToken.decimals,\n          glvToken.prices.minPrice\n        ) ?? 0n;\n      const glvTokenUsd =\n        convertToUsd(\n          glvTokenAmount,\n          glvToken.decimals,\n          glvToken.prices.minPrice\n        ) ?? 0n;\n\n      values.glvTokenAmount = glvTokenAmount;\n      values.glvTokenUsd = glvTokenUsd;\n\n      values.marketTokenAmount = marketTokenAmount ?? 0n;\n      values.marketTokenUsd = marketTokenUsd;\n\n      return values;\n    }\n\n    const priceImpactValues = getPriceImpactForSwap(\n      marketInfo,\n      longToken,\n      shortToken,\n      values.longTokenUsd,\n      values.shortTokenUsd\n    );\n\n    values.swapPriceImpactDeltaUsd = priceImpactValues.priceImpactDeltaUsd;\n\n    const totalDepositUsd = values.longTokenUsd + values.shortTokenUsd;\n\n    if (values.longTokenUsd > 0) {\n      const swapFeeUsd = p.forShift\n        ? 0n\n        : getSwapFee(\n            marketInfo,\n            values.longTokenUsd,\n            priceImpactValues.balanceWasImproved,\n            false\n          );\n      values.swapFeeUsd = values.swapFeeUsd + swapFeeUsd;\n\n      const uiFeeUsd = applyFactor(values.longTokenUsd, uiFeeFactor);\n      values.uiFeeUsd = values.uiFeeUsd + uiFeeUsd;\n\n      values.marketTokenAmount += getMarketTokenAmountByCollateral({\n        marketInfo,\n        marketToken,\n        tokenIn: longToken,\n        tokenOut: shortToken,\n        amount: values.longTokenAmount,\n        priceImpactDeltaUsd: bigMath.mulDiv(\n          values.swapPriceImpactDeltaUsd,\n          values.longTokenUsd,\n          totalDepositUsd\n        ),\n        swapFeeUsd,\n        uiFeeUsd,\n      });\n    }\n\n    if (values.shortTokenUsd > 0) {\n      const swapFeeUsd = p.forShift\n        ? 0n\n        : getSwapFee(\n            marketInfo,\n            values.shortTokenUsd,\n            priceImpactValues.balanceWasImproved,\n            false\n          );\n      values.swapFeeUsd = values.swapFeeUsd + swapFeeUsd;\n\n      const uiFeeUsd = applyFactor(values.shortTokenUsd, uiFeeFactor);\n      values.uiFeeUsd = values.uiFeeUsd + uiFeeUsd;\n\n      values.marketTokenAmount += getMarketTokenAmountByCollateral({\n        marketInfo,\n        marketToken,\n        tokenIn: shortToken,\n        tokenOut: longToken,\n        amount: values.shortTokenAmount,\n        priceImpactDeltaUsd: bigMath.mulDiv(\n          values.swapPriceImpactDeltaUsd,\n          values.shortTokenUsd,\n          totalDepositUsd\n        ),\n        swapFeeUsd,\n        uiFeeUsd,\n      });\n    }\n\n    values.marketTokenUsd = convertToUsd(\n      values.marketTokenAmount,\n      marketToken.decimals,\n      marketToken.prices.minPrice\n    )!;\n\n    if (glvInfo && glvToken) {\n      values.glvTokenUsd = values.marketTokenUsd;\n      values.glvTokenAmount = convertToTokenAmount(\n        values.glvTokenUsd,\n        glvToken.decimals,\n        glvToken.prices.minPrice\n      )!;\n    }\n  } else if (strategy === \"byMarketToken\") {\n    if (glvInfo && glvTokenAmount == 0n) {\n      return values;\n    }\n\n    if (!glvInfo && marketTokenAmount == 0n) {\n      return values;\n    }\n\n    if (glvInfo && glvToken) {\n      values.marketTokenUsd = convertToUsd(\n        glvTokenAmount,\n        glvToken.decimals,\n        glvToken.prices.minPrice\n      )!;\n      values.marketTokenAmount = convertToTokenAmount(\n        values.marketTokenUsd,\n        marketToken.decimals,\n        marketToken.prices.minPrice\n      )!;\n      values.glvTokenAmount = glvTokenAmount ?? 0n;\n      values.glvTokenUsd = values.marketTokenUsd;\n    } else {\n      values.marketTokenAmount = marketTokenAmount;\n      values.marketTokenUsd = marketTokenAmountToUsd(\n        marketInfo,\n        marketToken,\n        marketTokenAmount\n      );\n    }\n\n    if (glvInfo && isMarketTokenDeposit) {\n      return values;\n    }\n\n    const prevLongTokenUsd = convertToUsd(\n      longTokenAmount,\n      longToken.decimals,\n      longTokenPrice\n    )!;\n    const prevShortTokenUsd = convertToUsd(\n      shortTokenAmount,\n      shortToken.decimals,\n      shortTokenPrice\n    )!;\n    const prevSumUsd = prevLongTokenUsd + prevShortTokenUsd;\n\n    if (p.forShift) {\n      const longPoolAmount = marketInfo.longPoolAmount;\n      const shortPoolAmount = marketInfo.shortPoolAmount;\n\n      const longPoolUsd = convertToUsd(\n        longPoolAmount,\n        longToken.decimals,\n        longToken.prices.maxPrice\n      )!;\n      const shortPoolUsd = convertToUsd(\n        shortPoolAmount,\n        shortToken.decimals,\n        shortToken.prices.maxPrice\n      )!;\n      const totalPoolUsd = longPoolUsd + shortPoolUsd;\n\n      values.longTokenUsd = bigMath.mulDiv(\n        values.marketTokenUsd,\n        longPoolUsd,\n        totalPoolUsd\n      );\n      values.shortTokenUsd = bigMath.mulDiv(\n        values.marketTokenUsd,\n        shortPoolUsd,\n        totalPoolUsd\n      );\n    } else if (includeLongToken && includeShortToken && prevSumUsd > 0) {\n      values.longTokenUsd = bigMath.mulDiv(\n        values.marketTokenUsd,\n        prevLongTokenUsd,\n        prevSumUsd\n      );\n      values.shortTokenUsd = values.marketTokenUsd - values.longTokenUsd;\n    } else if (includeLongToken) {\n      values.longTokenUsd = values.marketTokenUsd;\n    } else if (includeShortToken) {\n      values.shortTokenUsd = values.marketTokenUsd;\n    }\n\n    const priceImpactValues = getPriceImpactForSwap(\n      marketInfo,\n      longToken,\n      shortToken,\n      values.longTokenUsd,\n      values.shortTokenUsd\n    );\n\n    values.swapPriceImpactDeltaUsd = priceImpactValues.priceImpactDeltaUsd;\n\n    if (!p.forShift) {\n      const swapFeeUsd = getSwapFee(\n        marketInfo,\n        values.marketTokenUsd,\n        priceImpactValues.balanceWasImproved,\n        false\n      );\n      values.swapFeeUsd = values.swapFeeUsd + swapFeeUsd;\n    }\n\n    const uiFeeUsd = applyFactor(values.marketTokenUsd, uiFeeFactor);\n    values.uiFeeUsd = values.uiFeeUsd + uiFeeUsd;\n\n    const totalFee = values.swapFeeUsd + values.uiFeeUsd;\n    let totalDepositUsd = values.longTokenUsd + values.shortTokenUsd;\n\n    if (totalDepositUsd > 0) {\n      values.longTokenUsd =\n        values.longTokenUsd +\n        bigMath.mulDiv(totalFee, values.longTokenUsd, totalDepositUsd);\n      values.shortTokenUsd =\n        values.shortTokenUsd +\n        bigMath.mulDiv(totalFee, values.shortTokenUsd, totalDepositUsd);\n\n      totalDepositUsd = values.longTokenUsd + values.shortTokenUsd;\n\n      if (values.swapPriceImpactDeltaUsd < 0 && totalDepositUsd > 0) {\n        values.longTokenUsd =\n          values.longTokenUsd +\n          bigMath.mulDiv(\n            -values.swapPriceImpactDeltaUsd,\n            values.longTokenUsd,\n            totalDepositUsd\n          );\n\n        values.shortTokenUsd =\n          values.shortTokenUsd +\n          bigMath.mulDiv(\n            -values.swapPriceImpactDeltaUsd,\n            values.shortTokenUsd,\n            totalDepositUsd\n          );\n      }\n    }\n\n    values.longTokenAmount = convertToTokenAmount(\n      values.longTokenUsd,\n      longToken.decimals,\n      longTokenPrice\n    )!;\n    values.shortTokenAmount = convertToTokenAmount(\n      values.shortTokenUsd,\n      shortToken.decimals,\n      shortTokenPrice\n    )!;\n  }\n\n  return values;\n}\n\nfunction getMarketTokenAmountByCollateral(p: {\n  marketInfo: MarketInfo;\n  marketToken: TokenData;\n  tokenIn: TokenData;\n  tokenOut: TokenData;\n  amount: bigint;\n  priceImpactDeltaUsd: bigint;\n  swapFeeUsd: bigint;\n  uiFeeUsd: bigint;\n}): bigint {\n  const {\n    marketInfo,\n    marketToken,\n    tokenIn,\n    tokenOut,\n    amount,\n    priceImpactDeltaUsd,\n    swapFeeUsd,\n    uiFeeUsd,\n  } = p;\n\n  const swapFeeAmount = convertToTokenAmount(\n    swapFeeUsd,\n    tokenIn.decimals,\n    tokenIn.prices.minPrice\n  )!;\n  const uiFeeAmount = convertToTokenAmount(\n    uiFeeUsd,\n    tokenIn.decimals,\n    tokenIn.prices.minPrice\n  )!;\n\n  let amountInAfterFees = amount - swapFeeAmount - uiFeeAmount;\n  let mintAmount = 0n;\n\n  if (priceImpactDeltaUsd > 0) {\n    const { impactDeltaAmount: positiveImpactAmount } = applySwapImpactWithCap(\n      marketInfo,\n      tokenOut,\n      priceImpactDeltaUsd\n    );\n\n    const usdValue = convertToUsd(\n      positiveImpactAmount,\n      tokenOut.decimals,\n      tokenOut.prices.maxPrice\n    )!;\n\n    mintAmount =\n      mintAmount + usdToMarketTokenAmount(marketInfo, marketToken, usdValue);\n  } else {\n    const { impactDeltaAmount: negativeImpactAmount } = applySwapImpactWithCap(\n      marketInfo,\n      tokenIn,\n      priceImpactDeltaUsd\n    );\n    amountInAfterFees = amountInAfterFees + negativeImpactAmount;\n  }\n\n  const usdValue = convertToUsd(\n    amountInAfterFees,\n    tokenIn.decimals,\n    tokenIn.prices.minPrice\n  )!;\n  mintAmount =\n    mintAmount + usdToMarketTokenAmount(marketInfo, marketToken, usdValue);\n\n  return mintAmount;\n}\n\nexport function getWithdrawalAmounts(p: {\n  marketInfo: MarketInfo;\n  marketToken: TokenData;\n  marketTokenAmount: bigint;\n  longTokenAmount: bigint;\n  shortTokenAmount: bigint;\n  uiFeeFactor: bigint;\n  strategy:\n    | \"byMarketToken\"\n    | \"byLongCollateral\"\n    | \"byShortCollateral\"\n    | \"byCollaterals\";\n  forShift?: boolean;\n  glvInfo?: GlvInfo;\n  glvTokenAmount?: bigint;\n  glvToken?: TokenData;\n}) {\n  const {\n    marketInfo,\n    marketToken,\n    marketTokenAmount,\n    longTokenAmount,\n    shortTokenAmount,\n    uiFeeFactor,\n    strategy,\n    glvInfo,\n    glvToken,\n    glvTokenAmount,\n  } = p;\n\n  const { longToken, shortToken } = marketInfo;\n\n  const longPoolAmount = marketInfo.longPoolAmount;\n  const shortPoolAmount = marketInfo.shortPoolAmount;\n\n  const longPoolUsd = convertToUsd(\n    longPoolAmount,\n    longToken.decimals,\n    longToken.prices.maxPrice\n  )!;\n  const shortPoolUsd = convertToUsd(\n    shortPoolAmount,\n    shortToken.decimals,\n    shortToken.prices.maxPrice\n  )!;\n\n  const totalPoolUsd = longPoolUsd + shortPoolUsd;\n\n  const values: WithdrawalAmounts = {\n    marketTokenAmount: 0n,\n    marketTokenUsd: 0n,\n    longTokenAmount: 0n,\n    longTokenUsd: 0n,\n    shortTokenAmount: 0n,\n    shortTokenUsd: 0n,\n    glvTokenAmount: 0n,\n    glvTokenUsd: 0n,\n    swapFeeUsd: 0n,\n    uiFeeUsd: 0n,\n    swapPriceImpactDeltaUsd: 0n,\n  };\n\n  if (totalPoolUsd == 0n) {\n    return values;\n  }\n\n  if (strategy === \"byMarketToken\") {\n    if (glvInfo) {\n      values.glvTokenAmount = glvTokenAmount!;\n      values.glvTokenUsd = convertToUsd(\n        glvTokenAmount,\n        glvToken?.decimals,\n        glvToken?.prices.minPrice\n      )!;\n      values.marketTokenAmount = convertToTokenAmount(\n        values.glvTokenUsd,\n        marketToken.decimals,\n        marketToken.prices.maxPrice\n      )!;\n      values.marketTokenUsd = values.glvTokenUsd;\n    } else {\n      values.marketTokenAmount = marketTokenAmount;\n      values.marketTokenUsd = marketTokenAmountToUsd(\n        marketInfo,\n        marketToken,\n        marketTokenAmount\n      );\n    }\n\n    values.longTokenUsd = bigMath.mulDiv(\n      values.marketTokenUsd,\n      longPoolUsd,\n      totalPoolUsd\n    );\n    values.shortTokenUsd = bigMath.mulDiv(\n      values.marketTokenUsd,\n      shortPoolUsd,\n      totalPoolUsd\n    );\n\n    const longSwapFeeUsd = p.forShift\n      ? 0n\n      : applyFactor(\n          values.longTokenUsd,\n          p.marketInfo.swapFeeFactorForBalanceWasNotImproved\n        );\n    const shortSwapFeeUsd = p.forShift\n      ? 0n\n      : applyFactor(\n          values.shortTokenUsd,\n          p.marketInfo.swapFeeFactorForBalanceWasNotImproved\n        );\n\n    const longUiFeeUsd = applyFactor(values.marketTokenUsd, uiFeeFactor);\n    const shortUiFeeUsd = applyFactor(values.shortTokenUsd, uiFeeFactor);\n\n    values.uiFeeUsd = applyFactor(values.marketTokenUsd, uiFeeFactor);\n    values.swapFeeUsd = longSwapFeeUsd + shortSwapFeeUsd;\n\n    values.longTokenUsd = values.longTokenUsd - longSwapFeeUsd - longUiFeeUsd;\n    values.shortTokenUsd =\n      values.shortTokenUsd - shortSwapFeeUsd - shortUiFeeUsd;\n\n    values.longTokenAmount = convertToTokenAmount(\n      values.longTokenUsd,\n      longToken.decimals,\n      longToken.prices.maxPrice\n    )!;\n    values.shortTokenAmount = convertToTokenAmount(\n      values.shortTokenUsd,\n      shortToken.decimals,\n      shortToken.prices.maxPrice\n    )!;\n  } else {\n    if (strategy === \"byLongCollateral\" && longPoolUsd > 0) {\n      values.longTokenAmount = longTokenAmount;\n      values.longTokenUsd = convertToUsd(\n        longTokenAmount,\n        longToken.decimals,\n        longToken.prices.maxPrice\n      )!;\n      values.shortTokenUsd = bigMath.mulDiv(\n        values.longTokenUsd,\n        shortPoolUsd,\n        longPoolUsd\n      );\n      values.shortTokenAmount = convertToTokenAmount(\n        values.shortTokenUsd,\n        shortToken.decimals,\n        shortToken.prices.maxPrice\n      )!;\n    } else if (strategy === \"byShortCollateral\" && shortPoolUsd > 0) {\n      values.shortTokenAmount = shortTokenAmount;\n      values.shortTokenUsd = convertToUsd(\n        shortTokenAmount,\n        shortToken.decimals,\n        shortToken.prices.maxPrice\n      )!;\n      values.longTokenUsd = bigMath.mulDiv(\n        values.shortTokenUsd,\n        longPoolUsd,\n        shortPoolUsd\n      );\n      values.longTokenAmount = convertToTokenAmount(\n        values.longTokenUsd,\n        longToken.decimals,\n        longToken.prices.maxPrice\n      )!;\n    } else if (strategy === \"byCollaterals\") {\n      values.longTokenAmount = longTokenAmount;\n      values.longTokenUsd = convertToUsd(\n        longTokenAmount,\n        longToken.decimals,\n        longToken.prices.maxPrice\n      )!;\n      values.shortTokenAmount = shortTokenAmount;\n      values.shortTokenUsd = convertToUsd(\n        shortTokenAmount,\n        shortToken.decimals,\n        shortToken.prices.maxPrice\n      )!;\n\n      values.uiFeeUsd = applyFactor(\n        values.longTokenUsd + values.shortTokenUsd,\n        uiFeeFactor\n      );\n      values.marketTokenUsd += values.uiFeeUsd;\n    }\n\n    values.marketTokenUsd =\n      values.marketTokenUsd + values.longTokenUsd + values.shortTokenUsd;\n    if (!p.forShift) {\n      values.swapFeeUsd = applyFactor(\n        values.longTokenUsd + values.shortTokenUsd,\n        p.marketInfo.swapFeeFactorForBalanceWasNotImproved\n      );\n    }\n\n    values.marketTokenUsd = values.marketTokenUsd + values.swapFeeUsd;\n    values.marketTokenAmount = usdToMarketTokenAmount(\n      marketInfo,\n      marketToken,\n      values.marketTokenUsd\n    )!;\n\n    if (glvInfo) {\n      values.glvTokenUsd = convertToUsd(\n        values.marketTokenAmount,\n        marketToken?.decimals,\n        marketToken?.prices.minPrice\n      )!;\n      values.glvTokenAmount = convertToTokenAmount(\n        values.glvTokenUsd,\n        glvToken?.decimals,\n        glvToken?.prices.minPrice\n      )!;\n    }\n  }\n\n  return values;\n}\n\nexport type ShiftAmounts = {\n  fromTokenAmount: bigint;\n  fromTokenUsd: bigint;\n  fromLongTokenAmount: bigint;\n  fromShortTokenAmount: bigint;\n  toTokenAmount: bigint;\n  toTokenUsd: bigint;\n  uiFeeUsd: bigint;\n  swapPriceImpactDeltaUsd: bigint;\n};\n\nexport function getShiftAmounts({\n  strategy,\n  fromToken,\n  fromMarketInfo,\n  toToken,\n  toMarketInfo,\n  fromTokenAmount,\n  toTokenAmount,\n  uiFeeFactor,\n}: {\n  strategy: \"byFromToken\" | \"byToToken\";\n  fromToken: TokenData;\n  fromMarketInfo: MarketInfo;\n  toToken: TokenData;\n  toMarketInfo: MarketInfo;\n  fromTokenAmount: bigint;\n  toTokenAmount: bigint;\n  uiFeeFactor: bigint;\n}): ShiftAmounts {\n  const values: ShiftAmounts = {\n    fromTokenAmount: 0n,\n    fromTokenUsd: 0n,\n    fromLongTokenAmount: 0n,\n    fromShortTokenAmount: 0n,\n    toTokenAmount: 0n,\n    toTokenUsd: 0n,\n    uiFeeUsd: 0n,\n    swapPriceImpactDeltaUsd: 0n,\n  };\n\n  if (strategy === \"byFromToken\") {\n    values.fromTokenAmount = fromTokenAmount;\n    values.fromTokenUsd = marketTokenAmountToUsd(\n      fromMarketInfo,\n      fromToken,\n      fromTokenAmount\n    );\n\n    const withdrawalAmounts = getWithdrawalAmounts({\n      marketInfo: fromMarketInfo,\n      marketToken: fromToken,\n      marketTokenAmount: fromTokenAmount,\n      strategy: \"byMarketToken\",\n      longTokenAmount: 0n,\n      shortTokenAmount: 0n,\n      uiFeeFactor: uiFeeFactor,\n      forShift: true,\n    });\n\n    const depositAmounts = getDepositAmounts({\n      marketInfo: toMarketInfo,\n      marketToken: toToken,\n      longToken: toMarketInfo.longToken,\n      shortToken: toMarketInfo.shortToken,\n      longTokenAmount: withdrawalAmounts.longTokenAmount,\n      shortTokenAmount: withdrawalAmounts.shortTokenAmount,\n      marketTokenAmount: 0n,\n      strategy: \"byCollaterals\",\n      includeLongToken: false,\n      includeShortToken: false,\n      uiFeeFactor: 0n,\n      forShift: true,\n      isMarketTokenDeposit: false,\n    });\n\n    values.fromLongTokenAmount = withdrawalAmounts.longTokenAmount;\n    values.fromShortTokenAmount = withdrawalAmounts.shortTokenAmount;\n\n    values.uiFeeUsd = withdrawalAmounts.uiFeeUsd;\n    values.swapPriceImpactDeltaUsd = depositAmounts.swapPriceImpactDeltaUsd;\n\n    values.toTokenAmount = depositAmounts.marketTokenAmount;\n    values.toTokenUsd = marketTokenAmountToUsd(\n      toMarketInfo,\n      toToken,\n      depositAmounts.marketTokenAmount\n    );\n  } else {\n    values.toTokenAmount = toTokenAmount;\n    values.toTokenUsd = marketTokenAmountToUsd(\n      toMarketInfo,\n      toToken,\n      toTokenAmount\n    );\n\n    const withdrawalAmounts = getWithdrawalAmounts({\n      marketInfo: fromMarketInfo,\n      marketToken: fromToken,\n      strategy: \"byMarketToken\",\n      marketTokenAmount: usdToMarketTokenAmount(\n        fromMarketInfo,\n        fromToken,\n        values.toTokenUsd\n      ),\n      longTokenAmount: 0n,\n      shortTokenAmount: 0n,\n      uiFeeFactor: uiFeeFactor,\n      forShift: true,\n    });\n\n    const depositAmounts = getDepositAmounts({\n      marketInfo: toMarketInfo,\n      marketToken: toToken,\n      strategy: \"byCollaterals\",\n      longToken: toMarketInfo.longToken,\n      longTokenAmount: withdrawalAmounts.longTokenAmount,\n      shortToken: toMarketInfo.shortToken,\n      shortTokenAmount: withdrawalAmounts.shortTokenAmount,\n      marketTokenAmount: 0n,\n      includeLongToken: true,\n      includeShortToken: true,\n      uiFeeFactor: 0n,\n      forShift: true,\n      isMarketTokenDeposit: false,\n    });\n\n    values.fromLongTokenAmount = depositAmounts.longTokenAmount;\n    values.fromShortTokenAmount = depositAmounts.shortTokenAmount;\n\n    values.uiFeeUsd = withdrawalAmounts.uiFeeUsd;\n    values.swapPriceImpactDeltaUsd = depositAmounts.swapPriceImpactDeltaUsd;\n\n    values.fromTokenAmount =\n      withdrawalAmounts.marketTokenAmount -\n      usdToMarketTokenAmount(\n        fromMarketInfo,\n        fromToken,\n        values.swapPriceImpactDeltaUsd\n      );\n    values.fromTokenUsd = marketTokenAmountToUsd(\n      fromMarketInfo,\n      fromToken,\n      values.fromTokenAmount\n    );\n  }\n\n  return values;\n}\n"]}